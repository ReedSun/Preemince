<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="ReedSun">
<meta property="og:type" content="website">
<meta property="og:title" content="Preeminent">
<meta property="og:url" content="http://reedsun.top/index.html">
<meta property="og:site_name" content="Preeminent">
<meta property="og:description" content="ReedSun">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Preeminent">
<meta name="twitter:description" content="ReedSun">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://reedsun.top/"/>





  <title>Preeminent</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Preeminent</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">I have on idea about subtitle yet</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2017/04/17/webpack学习笔记 （下）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/17/webpack学习笔记 （下）/" itemprop="url">webpack学习笔记 （下）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-17T21:17:32+08:00">
                2017-04-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="代码分割"><a href="#代码分割" class="headerlink" title="代码分割"></a>代码分割</h3><p>对于一个大型的 Webapp 来说，把所有 JS 文件都放在同一个文件中是肯定不合理的！这会大大影响它的性能。webpack 允许我们把代码分割成几块。如果一些代码仅会在一些特定的情况下才执行时，webpack 会按需加载他们。</p>
<h4 id="require-ensure"><a href="#require-ensure" class="headerlink" title="require.ensure"></a>require.ensure</h4><p>我们可以使用 <code>require.ensure</code> 来定义一个分割点来实现代码分割。如下实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// main.js</div><div class="line">document.write(&apos;I will perform right now&apos;)</div><div class="line">setTimeout(function()&#123;</div><div class="line">	require.ensure([&apos;./a&apos;], function(require) &#123;</div><div class="line">	  var content = require(&apos;./a&apos;);</div><div class="line">	  document.open();</div><div class="line">	  document.write(content);</div><div class="line">	  document.close();</div><div class="line">	&#125;);</div><div class="line">&#125;, 3000)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// a.js</div><div class="line">module.exports = &apos;I will perform in 3 seconds.&apos;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// webpack.config.js</div><div class="line">module.exports = &#123;</div><div class="line">  entry: &apos;./index.js&apos;,</div><div class="line">  output: &#123;</div><div class="line">    filename: &apos;bundle.js&apos;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>webpack.config.js</code> 不需要做任何特殊处理，我们会发现 webpack 打包生成了两个文件 <code>bundle.js</code> 和 <code>0.bundle.js</code> ，打开网页我们会发现3秒之后 <code>0.bundle.js</code> 才会加载。</p>
<h4 id="bundle-loader"><a href="#bundle-loader" class="headerlink" title="bundle-loader"></a>bundle-loader</h4><p>除了用上面的 <code>require.ensure</code>，我们还可以用 <code>bundle-loader</code> 来实现代码分割。实例与 <code>require.ensure</code> 类似，只有 <code>main.js</code> 文件略有不同。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">document.write(&apos;I will perform right now&apos;)</div><div class="line">setTimeout(function()&#123;</div><div class="line">	var load = require(&apos;bundle-loader!./a.js&apos;)</div><div class="line">	load(function(content) &#123;</div><div class="line">	  document.open();</div><div class="line">	  document.write(content);</div><div class="line">	  document.close();</div><div class="line">	&#125;);</div><div class="line">&#125;, 3000)</div></pre></td></tr></table></figure>
<p>webpack 同样打包生成了两个文件 <code>bundle.js</code> 和 <code>0.bundle.js</code> ，同时也实现了按需加载。</p>
<p>####　通用的代码块</p>
<p>我们先来看一个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// main1.js</div><div class="line">import Vue from &apos;vue&apos;</div><div class="line">var vm = new Vue(&#123;</div><div class="line">	el: &apos;#a&apos;,</div><div class="line">	data: &#123;</div><div class="line">		a: &quot;Hello&quot;</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// main2.js</div><div class="line">import Vue from &apos;vue&apos;</div><div class="line">var vm = new Vue(&#123;</div><div class="line">	el: &apos;#b&apos;,</div><div class="line">	data: &#123;</div><div class="line">		b: &quot;ReedSun&quot;</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// index.html</div><div class="line">&lt;html&gt;</div><div class="line">	&lt;body&gt;</div><div class="line">		&lt;div id=&quot;a&quot;&gt;&#123;&#123;a&#125;&#125;&lt;/div&gt;</div><div class="line">		&lt;div id=&quot;b&quot;&gt;&#123;&#123;b&#125;&#125;&lt;/div&gt;</div><div class="line">		&lt;script src=&quot;bundle1.js&quot;&gt;&lt;/script&gt;</div><div class="line">		&lt;script src=&quot;bundle2.js&quot;&gt;&lt;/script&gt;</div><div class="line">	&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// webpack.config.js</div><div class="line">module.exports = &#123;</div><div class="line">	entry: &#123;</div><div class="line">		bundle1: &apos;./main1.js&apos;,</div><div class="line">		bundle2: &apos;./main2.js&apos;</div><div class="line">	&#125;,</div><div class="line">	output: &#123;</div><div class="line">		filename: &apos;[name].js&apos;</div><div class="line">	&#125;,</div><div class="line">	resolve: &#123;</div><div class="line">		alias: &#123;</div><div class="line">			&apos;vue&apos;: &apos;vue/dist/vue.js&apos;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>webpack.config.js</code>中的 <code>resolve</code> 是别名的意思，通过配置它，我们可以直接使用 <code>require(&#39;vue&#39;)</code>， 而不用使用 <code>require(&#39;vue/dist/vue.js&#39;)</code> 了。</p>
<p>这是一个用Vue渲染页面的简单用例，我们使用 webpack 打包后惊人的发现， webpack在两个脚本中将 <code>Vue</code> 打包了两次！ 这怎么能行！还好，万能的 webpack 提供了 <code>CommonsChunkPlugin</code> 插件，这个插件可以将不同脚本中引用的相同的代码块提取出来，打包成一个单独通用代码块，厉害了我的哥！</p>
<p>使用 <code>CommonsChunkPlugin</code> 插件，我们需要对 <code>index.html</code> 和 <code>webpack.config.js</code> 做如下修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// index.html</div><div class="line">&lt;html&gt;</div><div class="line">	&lt;body&gt;</div><div class="line">		&lt;div id=&quot;a&quot;&gt;&#123;&#123;a&#125;&#125;&lt;/div&gt;</div><div class="line">		&lt;div id=&quot;b&quot;&gt;&#123;&#123;b&#125;&#125;&lt;/div&gt;</div><div class="line">		&lt;script src=&quot;common.js&quot;&gt;&lt;/script&gt;</div><div class="line">		&lt;script src=&quot;bundle1.js&quot;&gt;&lt;/script&gt;</div><div class="line">		&lt;script src=&quot;bundle2.js&quot;&gt;&lt;/script&gt;</div><div class="line">	&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">var CommonsChunkPlugin = require(&quot;webpack/lib/optimize/CommonsChunkPlugin&quot;)</div><div class="line">module.exports = &#123;</div><div class="line">	entry: &#123;</div><div class="line">		bundle1: &apos;./main1.js&apos;,</div><div class="line">		bundle2: &apos;./main2.js&apos;</div><div class="line">	&#125;,</div><div class="line">	output: &#123;</div><div class="line">		filename: &apos;[name].js&apos;</div><div class="line">	&#125;,</div><div class="line">	resolve: &#123;</div><div class="line">		alias: &#123;</div><div class="line">			&apos;vue&apos;: &apos;vue/dist/vue.js&apos;</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	plugins: [</div><div class="line">		new CommonsChunkPlugin(&apos;common&apos;)</div><div class="line">	]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>嗯~这样一来，通用的依赖只会被 Webpack 打包一次，优化了好多性能。</p>
<h4 id="Vendor-chunk"><a href="#Vendor-chunk" class="headerlink" title="Vendor chunk"></a>Vendor chunk</h4><p>上例中，我们用 <code>CommonsChunkPlugin</code> 将通用的代码块分离出来。当然，我们也可以用它来将第三方库类文件和我们自己写的代码分离。示例代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">\\ index.html</div><div class="line">&lt;html&gt;</div><div class="line">	&lt;body&gt;</div><div class="line">		&lt;div id=&quot;a&quot;&gt;&#123;&#123;a&#125;&#125;&lt;/div&gt;</div><div class="line">		&lt;script src=&quot;vendor.js&quot;&gt;&lt;/script&gt;</div><div class="line">		&lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;</div><div class="line">	&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">\\ main.js</div><div class="line">import Vue from &apos;vue&apos;</div><div class="line">var vm = new Vue(&#123;</div><div class="line">	el: &apos;#a&apos;,</div><div class="line">	data: &#123;</div><div class="line">		a: &quot;Hello&quot;</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">\\ webpack.config.js</div><div class="line">var CommonsChunkPlugin = require(&quot;webpack/lib/optimize/CommonsChunkPlugin&quot;)</div><div class="line">module.exports = &#123;</div><div class="line">	entry: &#123;</div><div class="line">		app: &apos;./main.js&apos;,</div><div class="line">		vendor: [&apos;vue&apos;]</div><div class="line">	&#125;,</div><div class="line">	output: &#123;</div><div class="line">		filename: &apos;bundle.js&apos;</div><div class="line">	&#125;,</div><div class="line">	resolve: &#123;</div><div class="line">		alias: &#123;</div><div class="line">			&apos;vue&apos;: &apos;vue/dist/vue.js&apos;</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	plugins: [</div><div class="line">		new webpack.optimize.CommonsChunkPlugin(/* chunkName= */&apos;vendor&apos;, /* filename= */&apos;vendor.js&apos;)</div><div class="line">	]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行 <code>webpack</code> 之后，程序会把代码打包到两个文件 <code>bundls.js</code> 和 <code>vendor.js</code> ，这样就把我们自己的代码和我们引入的第三方库进行了分离。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2017/04/14/webpack学习笔记 （上）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/14/webpack学习笔记 （上）/" itemprop="url">webpack学习笔记 （上）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-14T22:38:44+08:00">
                2017-04-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这几天晚上在跟着<a href="https://github.com/ruanyf/webpack-demos" target="_blank" rel="external">阮一峰的Webpack教程</a>复习Webpack，发现Webpack确实是一个非常优秀的前端工具，能做的事真是超级多。当然能做的事情越多，他的配置文件可能就越复杂。像我记性这么差的人。还是写个博客记录一下吧！毕竟好记性不如烂笔头！</p>
<h2 id="关于webpack"><a href="#关于webpack" class="headerlink" title="关于webpack"></a>关于webpack</h2><p>webpack的配置文件是 <code>webpack.config.js</code> ， <code>webpack.config.js</code> 通过 <code>module.exports</code> 输出配置文件。</p>
<p>有了 <code>webpack.config.js</code> 之后，我们就可以通过在命令行执行如下命令使用webpack打包我们的代码了。</p>
<ul>
<li><code>$ webpack</code> =&gt; 基本操作，为开发环境打包代码</li>
<li><code>$ webpack -p</code> =&gt; 为生产环境打包代码（压缩代码）</li>
<li><code>$ webpack --watch</code> =&gt; 增量打包代码 （每次修改文件即会自动重新打包文件）</li>
<li><code>$ webpack -d</code> =&gt; 打包同时生成source maps位置文件</li>
<li><code>$ webpack --colors</code> =&gt; 让打包信息使用不同的颜色，易于观察</li>
</ul>
<p>我们可以使用 <code>npm</code> 配置文件 <code>package.json</code> 的 <code>scripts</code> 命令简化我们的操作，示例如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// package.json</div><div class="line">&#123;</div><div class="line">    // ...</div><div class="line">    &quot;script&quot;: &#123;</div><div class="line">        &quot;dev&quot; : &quot;webpack --watch --colors&quot;</div><div class="line">    &#125;,</div><div class="line">    // ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="关于webpack-Dev-Server"><a href="#关于webpack-Dev-Server" class="headerlink" title="关于webpack Dev Server"></a>关于webpack Dev Server</h2><p>关于 <code>webpack Dev Server</code> ，<a href="https://github.com/webpack/webpack-dev-server" target="_blank" rel="external">webpack的GitHub</a>是这么介绍它的：</p>
<blockquote>
<p>Serves a webpack app. Updates the browser on changes.</p>
</blockquote>
<p><code>webpack Dev Server</code>是一个小型的服务器，为我们的webpack应用服务。与 <code>webpack</code> 类似，我们在命令行中通过执行如下指令打开服务器、打包代码。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ webpack-dev-server</div></pre></td></tr></table></figure></p>
<p>我们打开了服务器，就可以在浏览器中通过<code>http://loaclhost:8080</code>访问网页，查看我们打包的代码。</p>
<p>同时， <code>webpack-dev-server</code> 还支持热重载，即我们更新了我们代码，页面将自动刷新并打包我们的代码。</p>
<h2 id="正式开始"><a href="#正式开始" class="headerlink" title="正式开始"></a>正式开始</h2><h3 id="入口文件"><a href="#入口文件" class="headerlink" title="入口文件"></a>入口文件</h3><p>入口文件是 <code>webpack</code> 运行并打包文件的入口文件。Webpack 会分析入口文件，解析包含依赖关系的各个文件。将这些文件（模块）都打包到 bundle.js 。我们通过 <code>entry</code> 属性来指定它。如下示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// webpack.config.js</div><div class="line">module.exports = &#123;</div><div class="line">    entry: &apos;./main.js&apos;,</div><div class="line">    output: &#123;</div><div class="line">        filename: &apos;bundles.js&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此时入口文件是 <code>main.js</code>， <code>webpack</code> 会将 <code>main.js</code> 打包到 <code>bundles.js</code> 文件中。</p>
<p>入口文件也可以是多个文件，这对一个多页应用来说很有帮助。如下示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">module.exports = &#123;</div><div class="line">    entry: &#123;</div><div class="line">        bundle1: &apos;./main1.js&apos;,</div><div class="line">        bundle2: &apos;./main2.js&apos;</div><div class="line">    &#125;,</div><div class="line">    output: &apos;[name].js]&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此时入口文件有两个，分别是 <code>main1.js</code> 和 <code>main2.js</code> ， <code>webpack</code> 会将这两个文件分别打包到 <code>bundle1.js</code> 和 <code>bundle2.js</code> 中。</p>
<h3 id="加载器（loader）"><a href="#加载器（loader）" class="headerlink" title="加载器（loader）"></a>加载器（loader）</h3><p>加载器是需要用webpack打包的资源文件的预处理器。我在这里将介绍 <code>Bable-loader</code> 、 <code>CSS-loader</code> 和 <code>Image-loader</code> 这三个加载器。</p>
<p>加载器需要在配置文件中的 <code>module.loaders</code>中定义，如下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">module.explorts = &#123;</div><div class="line">    // ..</div><div class="line">    module: &#123;</div><div class="line">        loaders: &#123;</div><div class="line">            test: /\.js[x]?$/,  // 正则匹配需要用加载器预处理的文件</div><div class="line">            exclude: /node_modules/,  // 正则匹配排除的文件或文件夹, 忽略则匹配所有涉及的文件</div><div class="line">            include: /src/,  // 正则匹配包含的文件或文件，忽略则匹配所有涉及的文件</div><div class="line">            loader: &apos;babel-loader&apos;  // 加载器</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="bable-loader"><a href="#bable-loader" class="headerlink" title="bable-loader"></a>bable-loader</h4><p><code>Bable-loader</code> 可以将 JSX/ES6 文件转化为 ES5 规范下的 JS 文件。如下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">module.exports = &#123;</div><div class="line">  // ...</div><div class="line">  module: &#123;</div><div class="line">    loaders:[</div><div class="line">      &#123;</div><div class="line">        test: /\.js[x]?$/,</div><div class="line">        exclude: /node_modules/,</div><div class="line">        loader: &apos;babel-loader?presets[]=es2015&apos;</div><div class="line">      &#125;,</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>这里 <code>babel-loader</code> 需要用到 <code>babel-preset-es2015</code> 插件，将 <code>ES2015</code> 语法转化为 <code>ES5</code> 语法，如上示例是一种写法，还有另一种写法，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">module: &#123;</div><div class="line">  loaders: [</div><div class="line">    &#123;</div><div class="line">      test: /\.jsx?$/,</div><div class="line">      exclude: /node_modules/,</div><div class="line">      loader: &apos;babel&apos;,</div><div class="line">      query: &#123;</div><div class="line">        presets: [&apos;es2015&apos;]</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="css-loader"><a href="#css-loader" class="headerlink" title="css-loader"></a>css-loader</h4><p>如果我们在被 Webpack 处理的文件中引入了 CSS 文件，我们就需要使用 <code>CSS-loader</code> 来处理这些 CSS 文件，如下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">module.exports = &#123;</div><div class="line">  // ..</div><div class="line">  module: &#123;</div><div class="line">    loaders:[</div><div class="line">      &#123; </div><div class="line">          test: /\.css$/, </div><div class="line">          loader: &apos;style-loader!css-loader&apos; &#125;,</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>注意，我们这里使用两个加载器来转换 CSS 文件， 一个是 <code>css-loader</code> 来编译CSS文件， 另一个是 <code>style-loader</code> 将 CSS 代码引入 HTML 文件中。</p>
<p>两个不同的加载器需要用 <code>!</code> 来连接。</p>
<h4 id="image-loader"><a href="#image-loader" class="headerlink" title="image-loader"></a>image-loader</h4><p>Webpack 也可以打包图片到JS中，如下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">module.exports = &#123;</div><div class="line">  // ...</div><div class="line">  module: &#123;</div><div class="line">    loaders:[</div><div class="line">      &#123; </div><div class="line">          test: /\.(png|jpg)$/, </div><div class="line">          loader: &apos;url-loader?limit=8192&apos; &#125;</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>看这里 <code>url-loader?limit=8192</code> ，我们之前在 <code>bable-loader</code> 里见过， 这次的查询关键词是 <code>limit</code> ，意义是最大限制，即 如果小于 8192B 的图片文件将会被转换，小于8192B 的图片文件将不会被转换。</p>
<h3 id="插件（plugin）"><a href="#插件（plugin）" class="headerlink" title="插件（plugin）"></a>插件（plugin）</h3><p>Webpack有一套插件系统来扩展他的功能，我们之前说了加载器是在配置文件中的 <code>modules.loaders</code> 中声明，而插件就是在 <code>plugins</code> 中声明。</p>
<p>我们在这里介绍三个插件 <code>uglifyJsPlugin</code> 、 <code>html-webpack-plugin</code> 和 <code>open-browser-webpack-plugin</code> 。</p>
<p>如它的名字， <code>uglifyJsPlugin</code> 作用是压缩JS代码，是 Webpack 自带的插件。</p>
<p><code>html-webpack-plugin</code> 和 <code>open-browser-webpack-plugin</code> 都是 Webpack 的第三方插件。 <code>html-webpack-plugin</code> 的作用是自动生成一个 HTML 文件。 <code>open-browser-webpack-plugin</code> 的作用是可以在 Webpack 加载时自动打开一个浏览器页面，这个可就厉害了，配合 <code>webpack-dev-server</code> 我们可以在 Webpack 执行后，不用动手就看到效果。</p>
<p>如下示例展示了这三个插件的声明方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">var webpack = require(&apos;webpack&apos;);</div><div class="line">var uglifyJsPlugin = webpack.optimize.UglifyJsPlugin;</div><div class="line">module.exports = &#123;</div><div class="line">  // ..</div><div class="line">  plugins: [</div><div class="line">    new uglifyJsPlugin(&#123;</div><div class="line">      compress: &#123;</div><div class="line">        warnings: false</div><div class="line">      &#125;</div><div class="line">    &#125;),</div><div class="line">    new HtmlwebpackPlugin(&#123;</div><div class="line">      title: &apos;Webpack-demos&apos;,</div><div class="line">      filename: &apos;index.html&apos;</div><div class="line">    &#125;),</div><div class="line">    new OpenBrowserPlugin(&#123;</div><div class="line">      url: &apos;http://localhost:8080&apos;</div><div class="line">    &#125;)</div><div class="line">  ]</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>这样，我们不需要写 HTML 文件，运行 <code>webpack-dev-server</code> ， Webpack就自动为我们打包代码、压缩代码、创建 HTML 文件、打开浏览器。帅！</p>
<h3 id="环境标识"><a href="#环境标识" class="headerlink" title="环境标识"></a>环境标识</h3><p>Webpack 允许我们使用环境标识来区分开发环境和生产环境，从而让我们在开发环境中执行一些额外的代码。</p>
<p>比如，如果我们只想在开发环境中执行 <code>document.write(new Date())</code> 我们可以这样写我们的入口文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">document.write(&apos;&lt;h1&gt;Hello World&lt;/h1&gt;&apos;);</div><div class="line"></div><div class="line">if (devEnvironment) &#123;</div><div class="line">  document.write(new Date());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在配置文件中使用 <code>DefinePlugin</code> 插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">var webpack = require(&apos;webpack&apos;);</div><div class="line"></div><div class="line">var devFlagPlugin = new webpack.DefinePlugin(&#123;</div><div class="line">  devEnvironment: JSON.stringify(JSON.parse(process.env.DEBUG || &apos;false&apos;))</div><div class="line">&#125;);</div><div class="line"></div><div class="line">module.exports = &#123;</div><div class="line">  entry: &apos;./main.js&apos;,</div><div class="line">  output: &#123;</div><div class="line">    filename: &apos;bundle.js&apos;</div><div class="line">  &#125;,</div><div class="line">  plugins: [devFlagPlugin]</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>最后，我们只需要在执行 Webpack 命令时传入环境标识，Webpack就会为我们将环境标识设为我们需要的值，从而确定执不执行一些代码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ env DEBUG=true webpack  // 此时为开发环境，执行额外代码</div><div class="line">$ webpack  // 此时为生产环境，不执行额外代码</div></pre></td></tr></table></figure>
<p>(未完待续)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2017/02/26/Vuex的五个核心属性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/26/Vuex的五个核心属性/" itemprop="url">Vuex的五个核心概念</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-26T13:34:10+08:00">
                2017-02-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文参考自<a href="http://vuex.vuejs.org/zh-cn/" target="_blank" rel="external">Vue文档</a>，说的非常详细，建议看文档。</p>
<h2 id="Vuex是什么？"><a href="#Vuex是什么？" class="headerlink" title="Vuex是什么？"></a>Vuex是什么？</h2><p>VueX 是一个专门为 Vue.js 应用设计的状态管理架构，统一管理和维护各个vue组件的可变化状态(你可以理解成 vue 组件里的某些 data )。</p>
<p>Vue有五个核心概念，<code>state</code>, <code>getters</code>, <code>mutations</code>, <code>actions</code>, <code>modules</code>。本文将对这个五个核心概念进行梳理。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p> state =&gt; 基本数据<br> getters =&gt; 从基本数据派生的数据<br> mutations =&gt; 提交更改数据的方法，同步！<br> actions =&gt; 像一个装饰器，包裹mutations，使之可以异步。<br> modules =&gt; 模块化Vuex</p>
<h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><p>state即Vuex中的基本数据！</p>
<h4 id="单一状态树"><a href="#单一状态树" class="headerlink" title="单一状态树"></a>单一状态树</h4><p>Vuex使用单一状态树，即用一个对象就包含了全部的状态数据。<code>state</code>作为构造器选项，定义了所有我们需要的基本状态参数。</p>
<h4 id="在Vue组件中获得Vuex属性"><a href="#在Vue组件中获得Vuex属性" class="headerlink" title="在Vue组件中获得Vuex属性"></a>在Vue组件中获得Vuex属性</h4><ul>
<li>我们可以通过Vue的<code>Computed</code>获得Vuex的state，如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">const store = new Vuex.Store(&#123;</div><div class="line">    state: &#123;</div><div class="line">        count:0</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line">const app = new Vue(&#123;</div><div class="line">    //..</div><div class="line">    store,</div><div class="line">    computed: &#123;</div><div class="line">        count: function()&#123;</div><div class="line">            return this.$store.state.count</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    //..</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>每当 <code>store.state.count</code> 变化的时候, 都会重新求取计算属性，并且触发更新相关联的 DOM。</p>
<h4 id="mapState辅助函数"><a href="#mapState辅助函数" class="headerlink" title="mapState辅助函数"></a>mapState辅助函数</h4><p>当一个组件需要获取多个状态时候，将这些状态都声明为计算属性会有些重复和冗余。为了解决这个问题，我们可以使用 mapState 辅助函数帮助我们生成计算属性，让你少按几次键。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">// 在单独构建的版本中辅助函数为 Vuex.mapState</div><div class="line">import &#123; mapState &#125; from &apos;vuex&apos;</div><div class="line"></div><div class="line">export default &#123;</div><div class="line">  // ...</div><div class="line">  computed: mapState(&#123;</div><div class="line">    // 箭头函数可使代码更简练</div><div class="line">    count: state =&gt; state.count,</div><div class="line"></div><div class="line">    // 传字符串参数 &apos;count&apos; 等同于 `state =&gt; state.count`</div><div class="line">    countAlias: &apos;count&apos;,</div><div class="line"></div><div class="line">    // 为了能够使用 `this` 获取局部状态，必须使用常规函数</div><div class="line">    countPlusLocalState (state) &#123;</div><div class="line">      return state.count + this.localCount</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当映射的计算属性的名称与 state 的子节点名称相同时，我们也可以给 mapState 传一个字符串数组。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">computed: mapState([</div><div class="line">  // 映射 this.count 为 store.state.count</div><div class="line">  &apos;count&apos;</div><div class="line">])</div></pre></td></tr></table></figure></p>
<h4 id="对象展开运算符"><a href="#对象展开运算符" class="headerlink" title="对象展开运算符"></a>对象展开运算符</h4><p>mapState 函数返回的是一个对象。我们如何将它与局部计算属性混合使用呢？通常，我们需要使用一个工具函数将多个对象合并为一个，以使我们可以将最终对象传给 computed 属性。但是自从有了对象展开运算符，我们可以极大地简化写法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">computed: &#123;</div><div class="line">  localComputed () //本地计算属性</div><div class="line">  //使用对象展开运算符将此对象混入到外部对象中</div><div class="line">  ...mapState(&#123;</div><div class="line">    //..</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li><p>对象运算符<br>  <code>...</code> 展开运算符（spread operator）允许一个表达式在某处展开。展开运算符在多个参数（用于函数调用）或多个元素（用于数组字面量）或者多个变量（用于解构赋值）的地方可以使用。</p>
<p>  展开运算符不能用在对象当中，因为目前展开运算符只能在可遍历对象（iterables）可用。iterables的实现是依靠[Symbol.iterator]函数，而目前只有Array,Set,String内置[Symbol.iterator]方法，而Object尚未内置该方法，因此无法使用展开运算符。不过ES7草案当中已经加入了对象展开运算符特性。</p>
<p>  例子：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">function test(a,b,c) &#123;</div><div class="line">    console.log(a);</div><div class="line">    console.log(b);</div><div class="line">    console.log(c);</div><div class="line">&#125;</div><div class="line">var args = [0,1,2];</div><div class="line">test(...args);  // 0  1  2</div></pre></td></tr></table></figure>
<ul>
<li>ES7草案中的对象展开运算符<br>  ES6中还不支持对对象的展开运算符，但是ES7中将支持。对象展开运算符符可以让我们更快捷地操作对象，如下例子：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">let &#123;x,y,...z&#125;=&#123;x:1,y:2,a:3,b:4&#125;;</div><div class="line">x; //1</div><div class="line">y; //2</div><div class="line">z; //&#123;a:3,b:4&#125;</div></pre></td></tr></table></figure>
<h4 id="组件仍然保有局部状态"><a href="#组件仍然保有局部状态" class="headerlink" title="组件仍然保有局部状态"></a>组件仍然保有局部状态</h4><p>使用 Vuex 并不意味着你需要将所有的状态放入 Vuex。虽然将所有的状态放到 Vuex 会使状态变化更显式和易调试，但也会使代码变得冗长和不直观。</p>
<p>如果有些状态严格属于单个组件，最好还是作为组件的局部状态。你应该根据你的应用开发需要进行权衡和确定。</p>
<h2 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h2><p>即从store的<code>state</code>中派生出的状态。</p>
<p>getters接收state作为其第一个参数，接受其他 getters 作为第二个参数，如不需要，第二个参数可以省略如下例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">const store = new Vuex.Store(&#123;</div><div class="line">    state: &#123;</div><div class="line">        count:0</div><div class="line">    &#125;，</div><div class="line">    getters: &#123;</div><div class="line">        // 单个参数</div><div class="line">        countDouble: function(state)&#123;</div><div class="line">            return state.count * 2</div><div class="line">        &#125;,</div><div class="line">        // 两个参数</div><div class="line">        countDoubleAndDouble: function(state, getters) &#123;</div><div class="line">            return getters.countDouble * 2</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>与state一样，我们也可以通过Vue的<code>Computed</code>获得Vuex的getters。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">const app = new Vue(&#123;</div><div class="line">    //..</div><div class="line">    store,</div><div class="line">    computed: &#123;</div><div class="line">        count: function()&#123;</div><div class="line">            return this.$store.state.count</div><div class="line">        &#125;,</div><div class="line">        countDouble: function()&#123;</div><div class="line">            return this.$store.getters.countDouble</div><div class="line">        &#125;,</div><div class="line">        countDoubleAndDouble: function()&#123;</div><div class="line">            return this.$store.getters.countDoubleAndDouble</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    //..</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h4 id="mapGetters-辅助函数"><a href="#mapGetters-辅助函数" class="headerlink" title="mapGetters 辅助函数"></a>mapGetters 辅助函数</h4><p>mapGetters 辅助函数仅仅是将 store 中的 getters 映射到局部计算属性，与state类似<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">import &#123; mapGetters &#125; from &apos;vuex&apos;</div><div class="line"></div><div class="line">export default &#123;</div><div class="line">  // ...</div><div class="line">  computed: &#123;</div><div class="line">  // 使用对象展开运算符将 getters 混入 computed 对象中</div><div class="line">    ...mapGetters([</div><div class="line">      &apos;countDouble&apos;,</div><div class="line">      &apos;CountDoubleAndDouble&apos;,</div><div class="line">      //..</div><div class="line">    ])</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果你想将一个 getter 属性另取一个名字，使用对象形式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mapGetters(&#123;</div><div class="line">  // 映射 this.double 为 store.getters.countDouble</div><div class="line">  double: &apos;countDouble&apos;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h2 id="mutations"><a href="#mutations" class="headerlink" title="mutations"></a>mutations</h2><p>提交mutation是更改Vuex中的store中的状态的唯一方法。</p>
<p>mutation必须是同步的，如果要异步需要使用action。</p>
<p>每个 mutation 都有一个字符串的 事件类型 (type) 和 一个 回调函数 (handler)。这个回调函数就是我们实际进行状态更改的地方，并且它会接受 state 作为第一个参数，提交载荷作为第二个参数。（提交荷载在大多数情况下应该是一个对象）,提交荷载也可以省略的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">const store = new Vuex.Store(&#123;</div><div class="line">  state: &#123;</div><div class="line">    count: 1</div><div class="line">  &#125;,</div><div class="line">  mutations: &#123;</div><div class="line">    //无提交荷载</div><div class="line">    increment(state) &#123;</div><div class="line">        state.count++</div><div class="line">    &#125;</div><div class="line">    //提交荷载</div><div class="line">    incrementN(state, obj) &#123;</div><div class="line">      state.count += obj.n</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>你不能直接调用一个 mutation handler。这个选项更像是事件注册：“当触发一个类型为 increment 的 mutation 时，调用此函数。”要唤醒一个 mutation handler，你需要以相应的 type 调用 store.commit 方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//无提交荷载</div><div class="line">store.commit(&apos;increment&apos;)</div><div class="line">//提交荷载</div><div class="line">store.commit(&apos;incrementN&apos;, &#123;</div><div class="line">    n: 100</div><div class="line">    &#125;)</div></pre></td></tr></table></figure></p>
<h4 id="对象风格的提交方式"><a href="#对象风格的提交方式" class="headerlink" title="对象风格的提交方式"></a>对象风格的提交方式</h4><p>我们也可以使用这样包含 type 属性的对象的提交方式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">store.commit(&#123;</div><div class="line">  type: &apos;incrementN&apos;,</div><div class="line">  n: 10</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="Mutations-需遵守-Vue-的响应规则"><a href="#Mutations-需遵守-Vue-的响应规则" class="headerlink" title="Mutations 需遵守 Vue 的响应规则"></a>Mutations 需遵守 Vue 的响应规则</h3><ul>
<li>最好提前在你的 store 中初始化好所有所需属性。</li>
<li>当需要在对象上添加新属性时，你应该<ul>
<li>使用 <code>Vue.set(obj, &#39;newProp&#39;, 123)</code>, 或者</li>
<li>以新对象替换老对象。例如，利用对象展开运算符我们可以这样写<code>state.obj = {...state.obj, newProp: 123 }</code></li>
</ul>
</li>
</ul>
<h3 id="mapMutations-辅助函数"><a href="#mapMutations-辅助函数" class="headerlink" title="mapMutations 辅助函数"></a>mapMutations 辅助函数</h3><p>与其他辅助函数类似，你可以在组件中使用 this.$store.commit(‘xxx’) 提交 mutation，或者使用 mapMutations 辅助函数将组件中的 methods 映射为 store.commit 调用（需要在根节点注入 store）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">import &#123; mapMutations &#125; from &apos;vuex&apos;</div><div class="line"></div><div class="line">export default &#123;</div><div class="line">  //..</div><div class="line">  methods: &#123;</div><div class="line">    ...mapMutations([</div><div class="line">      &apos;increment&apos; // 映射 this.increment() 为 this.$store.commit(&apos;increment&apos;)</div><div class="line">    ]),</div><div class="line">    ...mapMutations(&#123;</div><div class="line">      add: &apos;increment&apos; // 映射 this.add() 为 this.$store.commit(&apos;increment&apos;)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><p>Action 类似于 mutation，不同在于：</p>
<ul>
<li>Action 提交的是 mutation，而不是直接变更状态。</li>
<li>Action 可以包含任意异步操作。</li>
</ul>
<p>我们用如下例子来结束actions：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">const store = new Vuex.Store(&#123;</div><div class="line">  state: &#123;</div><div class="line">    count: 0</div><div class="line">  &#125;,</div><div class="line">  mutations: &#123;</div><div class="line">    increment (state) &#123;</div><div class="line">      state.count++</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  actions: &#123;</div><div class="line">    increment (context) &#123;</div><div class="line">      setInterval(function()&#123;</div><div class="line">        context.commit(&apos;increment&apos;)</div><div class="line">      &#125;, 1000)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p><strong>注意：Action 函数接受一个与 store 实例具有相同方法和属性的 context 对象</strong>，因此你可以调用 context.commit 提交一个 mutation，或者通过 context.state 和 context.getters 来获取 state 和 getters。</p>
<h3 id="分发actions"><a href="#分发actions" class="headerlink" title="分发actions"></a>分发actions</h3><p>Action 通过 <code>store.dispatch</code> 方法触发：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">store.dispatch(&apos;increment&apos;)</div></pre></td></tr></table></figure></p>
<h3 id="其他与mutations类似的地方"><a href="#其他与mutations类似的地方" class="headerlink" title="其他与mutations类似的地方"></a>其他与mutations类似的地方</h3><p>Actions 支持同样的载荷方式和对象方式进行分发：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// 以载荷形式分发</div><div class="line">store.dispatch(&apos;incrementN&apos;, &#123;</div><div class="line">  n: 10</div><div class="line">&#125;)</div><div class="line"></div><div class="line">// 以对象形式分发</div><div class="line">store.dispatch(&#123;</div><div class="line">  type: &apos;incrementN&apos;,</div><div class="line">  n: 10</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>mapActions辅助函数</p>
<p>你在组件中使用 <code>this.$store.dispatch(&#39;xxx&#39;)</code> 分发 action，或者使用 <code>mapActions</code> 辅助函数将组件的 methods 映射为 <code>store.dispatch</code> 调用（需要先在根节点注入 <code>store</code>）:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">import &#123; mapActions &#125; from &apos;vuex&apos;</div><div class="line"></div><div class="line">export default &#123;</div><div class="line">  //..</div><div class="line">  methods: &#123;</div><div class="line">    ...mapActions([</div><div class="line">      &apos;incrementN&apos; //映射 this.incrementN() 为 this.$store.dispatch(&apos;incrementN&apos;)</div><div class="line">    ]),</div><div class="line">    ...mapActions(&#123;</div><div class="line">      add: &apos;incrementN&apos; //映射 this.add() 为 this.$store.dispatch(&apos;incrementN&apos;)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><p>使用单一状态树，导致应用的所有状态集中到一个很大的对象。但是，当应用变得很大时，store 对象会变得臃肿不堪。</p>
<p>为了解决以上问题，Vuex 允许我们将 store 分割到模块（module）。每个模块拥有自己的 state、mutation、action、getters、甚至是嵌套子模块——从上至下进行类似的分割：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">const moduleA = &#123;</div><div class="line">  state: &#123; ... &#125;,</div><div class="line">  mutations: &#123; ... &#125;,</div><div class="line">  actions: &#123; ... &#125;,</div><div class="line">  getters: &#123; ... &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const moduleB = &#123;</div><div class="line">  state: &#123; ... &#125;,</div><div class="line">  mutations: &#123; ... &#125;,</div><div class="line">  actions: &#123; ... &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">const store = new Vuex.Store(&#123;</div><div class="line">  modules: &#123;</div><div class="line">    a: moduleA,</div><div class="line">    b: moduleB</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">store.state.a // -&gt; moduleA 的状态</div><div class="line">store.state.b // -&gt; moduleB 的状态</div></pre></td></tr></table></figure></p>
<h3 id="模块的局部状态"><a href="#模块的局部状态" class="headerlink" title="模块的局部状态"></a>模块的局部状态</h3><p>对于模块内部的 <code>mutation</code> 和 <code>getter</code>，接收的第一个参数是模块的局部状态,对于模块内部的 getter，根节点状态会作为第三个参数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">const moduleA = &#123;</div><div class="line">  state: &#123; count: 0 &#125;,</div><div class="line">  mutations: &#123;</div><div class="line">    increment (state) &#123;</div><div class="line">      // state 模块的局部状态</div><div class="line">      state.count++</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  getters: &#123;</div><div class="line">    doubleCount (state) &#123;</div><div class="line">      return state.count * 2</div><div class="line">    &#125;,</div><div class="line">    sumWithRootCount (state, getters, rootState) &#123;</div><div class="line">      return state.count + rootState.count</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同样，对于模块内部的 action，<code>context.state</code> 是局部状态，根节点的状态是 <code>context.rootState</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">const moduleA = &#123;</div><div class="line">  // ...</div><div class="line">  actions: &#123;</div><div class="line">    incrementIfOddOnRootSum (context) &#123;</div><div class="line">      if ((context.state.count + context.rootState.count) % 2 === 1) &#123;</div><div class="line">        commit(&apos;increment&apos;)</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2016/11/06/关于python中inspect模块的一些探究/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/06/关于python中inspect模块的一些探究/" itemprop="url">关于python中inspect模块的一些探究</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-06T12:13:30+08:00">
                2016-11-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我在学习到<a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001432339008728d0ddbe19ee594980be3f0644a9371894000" target="_blank" rel="external">实战Day5 - python教程 - 廖雪峰的官方网站</a>时，遇到了inspect模块，之前对这个inspect模块一无所知啊，所以本着打破砂锅问到底的精神，决定对inspect模块做一些探究。</p>
<p>根据度娘搜到的，inspect模块主要提供了四种用处：</p>
<p>(1). 对是否是模块，框架，函数等进行类型检查。</p>
<p>(2). 获取源码</p>
<p>(3). 获取类或函数的参数的信息</p>
<p>(4). 解析堆栈</p>
<p>我在这次课程中，只用到了第三种用处，即获取类或函数的参数的信息，下面我来探究一下。</p>
<h2 id="探究"><a href="#探究" class="headerlink" title="探究"></a>探究</h2><p>结合我正在学习的课程，我自己也对inspect做了一些探究。根据在课程中用到的一些函数及方法，我做了一个python脚本。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"># test</div><div class="line">import inspect</div><div class="line">def a(a, b=0, *c, d, e=1, **f):</div><div class="line">    pass</div><div class="line">aa = inspect.signature(a)</div><div class="line">print(&quot;inspect.signature（fn)是:%s&quot; % aa)</div><div class="line">print(&quot;inspect.signature（fn)的类型：%s&quot; % (type(aa)))</div><div class="line">print(&quot;\n&quot;)</div><div class="line"></div><div class="line">bb = aa.parameters</div><div class="line">print(&quot;signature.paramerters属性是:%s&quot; % bb)</div><div class="line">print(&quot;ignature.paramerters属性的类型是%s&quot; % type(bb))</div><div class="line">print(&quot;\n&quot;)</div><div class="line"></div><div class="line">for cc, dd in bb.items():</div><div class="line">    print(&quot;mappingproxy.items()返回的两个值分别是：%s和%s&quot; % (cc, dd))</div><div class="line">    print(&quot;mappingproxy.items()返回的两个值的类型分别是：%s和%s&quot; % (type(cc), type(dd)))</div><div class="line">    print(&quot;\n&quot;)</div><div class="line">    ee = dd.kind</div><div class="line">    print(&quot;Parameter.kind属性是:%s&quot; % ee)</div><div class="line">    print(&quot;Parameter.kind属性的类型是:%s&quot; % type(ee))</div><div class="line">    print(&quot;\n&quot;)</div><div class="line">    gg = dd.default</div><div class="line">    print(&quot;Parameter.default的值是: %s&quot; % gg)</div><div class="line">    print(&quot;Parameter.default的属性是: %s&quot; % type(gg))</div><div class="line">    print(&quot;\n&quot;)</div><div class="line">    </div><div class="line"></div><div class="line">ff = inspect.Parameter.KEYWORD_ONLY</div><div class="line">print(&quot;inspect.Parameter.KEYWORD_ONLY的值是:%s&quot; % ff)</div><div class="line">print(&quot;inspect.Parameter.KEYWORD_ONLY的类型是:%s&quot; % type(ff))</div></pre></td></tr></table></figure></p>
<p>执行以上脚本，将得到如下输出：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">inspect.signature（fn)是:(a, b=0, *c, d, e=1, **f)</div><div class="line">inspect.signature（fn)的类型：&lt;class &apos;inspect.Signature&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">signature.paramerters属性是:OrderedDict([(&apos;a&apos;, &lt;Parameter &quot;a&quot;&gt;), (&apos;b&apos;, &lt;Parameter &quot;b=0&quot;&gt;), (&apos;c&apos;, &lt;Parameter &quot;*c&quot;&gt;), (&apos;d&apos;, &lt;Parameter &quot;d&quot;&gt;), (&apos;e&apos;, &lt;Parameter &quot;e=1&quot;&gt;), (&apos;f&apos;, &lt;Parameter &quot;**f&quot;&gt;)])</div><div class="line">ignature.paramerters属性的类型是&lt;class &apos;mappingproxy&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">mappingproxy.items()返回的两个值分别是：a和a</div><div class="line">mappingproxy.items()返回的两个值的类型分别是：&lt;class &apos;str&apos;&gt;和&lt;class &apos;inspect.Parameter&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.kind属性是:POSITIONAL_OR_KEYWORD</div><div class="line">Parameter.kind属性的类型是:&lt;enum &apos;_ParameterKind&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.default的值是: &lt;class &apos;inspect._empty&apos;&gt;</div><div class="line">Parameter.default的属性是: &lt;class &apos;type&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">mappingproxy.items()返回的两个值分别是：b和b=0</div><div class="line">mappingproxy.items()返回的两个值的类型分别是：&lt;class &apos;str&apos;&gt;和&lt;class &apos;inspect.Parameter&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.kind属性是:POSITIONAL_OR_KEYWORD</div><div class="line">Parameter.kind属性的类型是:&lt;enum &apos;_ParameterKind&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.default的值是: 0</div><div class="line">Parameter.default的属性是: &lt;class &apos;int&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">mappingproxy.items()返回的两个值分别是：c和*c</div><div class="line">mappingproxy.items()返回的两个值的类型分别是：&lt;class &apos;str&apos;&gt;和&lt;class &apos;inspect.Parameter&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.kind属性是:VAR_POSITIONAL</div><div class="line">Parameter.kind属性的类型是:&lt;enum &apos;_ParameterKind&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.default的值是: &lt;class &apos;inspect._empty&apos;&gt;</div><div class="line">Parameter.default的属性是: &lt;class &apos;type&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">mappingproxy.items()返回的两个值分别是：d和d</div><div class="line">mappingproxy.items()返回的两个值的类型分别是：&lt;class &apos;str&apos;&gt;和&lt;class &apos;inspect.Parameter&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.kind属性是:KEYWORD_ONLY</div><div class="line">Parameter.kind属性的类型是:&lt;enum &apos;_ParameterKind&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.default的值是: &lt;class &apos;inspect._empty&apos;&gt;</div><div class="line">Parameter.default的属性是: &lt;class &apos;type&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">mappingproxy.items()返回的两个值分别是：e和e=1</div><div class="line">mappingproxy.items()返回的两个值的类型分别是：&lt;class &apos;str&apos;&gt;和&lt;class &apos;inspect.Parameter&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.kind属性是:KEYWORD_ONLY</div><div class="line">Parameter.kind属性的类型是:&lt;enum &apos;_ParameterKind&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.default的值是: 1</div><div class="line">Parameter.default的属性是: &lt;class &apos;int&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">mappingproxy.items()返回的两个值分别是：f和**f</div><div class="line">mappingproxy.items()返回的两个值的类型分别是：&lt;class &apos;str&apos;&gt;和&lt;class &apos;inspect.Parameter&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.kind属性是:VAR_KEYWORD</div><div class="line">Parameter.kind属性的类型是:&lt;enum &apos;_ParameterKind&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">Parameter.default的值是: &lt;class &apos;inspect._empty&apos;&gt;</div><div class="line">Parameter.default的属性是: &lt;class &apos;type&apos;&gt;</div><div class="line"></div><div class="line"></div><div class="line">inspect.Parameter.KEYWORD_ONLY的值是:KEYWORD_ONLY</div><div class="line">inspect.Parameter.KEYWORD_ONLY的类型是:&lt;enum &apos;_ParameterKind&apos;&gt;</div></pre></td></tr></table></figure></p>
<p>##总结</p>
<ul>
<li><p><code>inspect.signature（fn)</code>将返回一个<code>inspect.Signature</code>类型的对象，值为fn这个函数的所有参数</p>
</li>
<li><p><code>inspect.Signature</code>对象的<code>paramerters</code>属性是一个<code>mappingproxy</code>（映射）类型的对象，值为一个有序字典（Orderdict)。</p>
<ul>
<li><p>这个字典里的key是即为参数名，<code>str</code>类型</p>
</li>
<li><p>这个字典里的value是一个<code>inspect.Parameter</code>类型的对象，根据我的理解，这个对象里包含的一个参数的各种信息</p>
</li>
</ul>
</li>
<li><p><code>inspect.Parameter</code>对象的<code>kind</code>属性是一个<code>_ParameterKind</code>枚举类型的对象，值为这个参数的类型（可变参数，关键词参数，etc）</p>
</li>
<li><p><code>inspect.Parameter</code>对象的<code>default</code>属性：如果这个参数有默认值，即返回这个默认值，如果没有，返回一个<code>inspect._empty</code>类。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2016/10/31/python中的元类Metaclass/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/31/python中的元类Metaclass/" itemprop="url">python中的元类Metaclass</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-31T20:18:42+08:00">
                2016-10-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="理解元类之前需要学习的知识"><a href="#理解元类之前需要学习的知识" class="headerlink" title="理解元类之前需要学习的知识"></a>理解元类之前需要学习的知识</h2><p> 如果说让我们创建一个类，最先想到的肯定是用<code>class</code>创建，当我们使用<code>class</code>创建类的时候，python解释器自动创建这个对象，但是python同样也提供了手动处理的方法来创建类，这就是用python的自建函数<code>type()</code>。</p>
<p> 我们所熟知的<code>type()</code>函数的作用是返回一个参数的类型，但是实际上，它也有一种完全不同的能力，即接受一个类的一些描述作为参数，然后返回一个类。</p>
<p> <code>type()</code>函数的语法是这样的:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">type(类名, 父类的元组（针对继承的情况，可以为空），包含属性的字典（名称和值）)</div></pre></td></tr></table></figure></p>
<p>举个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">class ReedSun(ShuaiGe):</div><div class="line">    shuai = True</div><div class="line">    def test(x):</div><div class="line">        return x+2</div><div class="line"># 就等价于</div><div class="line">type(&quot;ReedSun&quot;, (ShuaiGe,), &#123;&quot;shuai&quot;:True, &quot;test&quot;:lambda x: x+2&#125;)</div><div class="line"># （属性和方法本质上都是方法）</div></pre></td></tr></table></figure></p>
<p>在python中，类也是对象，当我们使用class关键词创建一个类的时候，Python解释器仅仅是扫描一下class定义的语法，然后调用<code>type()</code>函数创建出class。</p>
<h2 id="元类是什么"><a href="#元类是什么" class="headerlink" title="元类是什么"></a>元类是什么</h2><p>元类是什么？元类实际上就是用来创建类的东西。为了帮助我们理解，我们可以这样想，我们创建类就是为了创建类的实例，同样的，我们创建元类就是为了创建类。元类就是类<em>（实例）</em>的类，就像下面这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Metaclass() = class</div><div class="line">class() = object  # object==&gt;实例</div></pre></td></tr></table></figure></p>
<p>理解了什么是元类，我们再来看一看type()函数。</p>
<p>其实type就是一个元类，type就是我们用来创建所有的类的元类。（如果我们要创建自己定义的元类的话，也要从type中继承）</p>
<h2 id="元类的工作原理"><a href="#元类的工作原理" class="headerlink" title="元类的工作原理"></a>元类的工作原理</h2><p>我们来看一下下面这个例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class ReedSunMetaclass(type):</div><div class="line">    pass</div><div class="line">    </div><div class="line">class Foo(object， metaclass = ReedSunMetaclass): </div><div class="line">    pass</div><div class="line">    </div><div class="line">class Bar(Foo):</div><div class="line">    pass</div></pre></td></tr></table></figure></p>
<ol>
<li><p>首先，我们创建了一个元类<code>ReedSunMetaclass</code><em>（注意！按照默认习惯，元类的类名总是以<code>Metaclass</code>结尾，以便清楚地表示这是一个元类）</em>。</p>
</li>
<li><p>然后，我们又用元类<code>ReedSunMetaclass</code>创建了一个<code>Foo</code>类，<em>（同时，<code>Foo</code>类的属性<code>__metaclass__</code>就变成了<code>ReedSunMetaclass</code>)</em>。</p>
</li>
<li><p>最后，我们创建了一个子类<code>Bar</code>继承自<code>Foo</code>。</p>
</li>
</ol>
<p>我们来试着理解一下在python内部是怎么执行这几个步骤的：</p>
<ul>
<li><p>对于父类<code>Foo</code>，Python会在类的定义中寻找<code>__metaclass__</code>属性，如果找到了，Python就会用它来创建类<code>Foo</code>，如果没有找到，就会用内建的type来创建这个类。很显然，它找到了。</p>
</li>
<li><p>对于子类<code>Bar</code>, python会先在子类中寻找<code>__metaclass__</code>属性，如果找到了，Python就会用它来创建类<code>Bar</code>，如果没有找到，就再从父类中寻找，直到type。显然，它在父类中找到了。</p>
</li>
</ul>
<p><strong>我们可以看到使用元类的一个好处了，即他可以让子类隐式的继承一些东西。</strong></p>
<h2 id="自定义元类"><a href="#自定义元类" class="headerlink" title="自定义元类"></a>自定义元类</h2><p>元类的主要目的就是为了当创建类时能够自动地改变类。创建类我们需要定义<code>__new__()</code>函数，<code>__new__</code> 是在<code>__init__</code>之前被调用的特殊方法，是用来创建对象并返回之的方法。我们举个例子来说明定义自定义元类的方法。</p>
<p><code>__new__()</code>方法接收到的参数依次是：</p>
<ol>
<li>当前准备创建的类的对象；</li>
<li>类的名字；</li>
<li>类继承的父类集合；</li>
<li>类的方法集合。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class ReedSunMetaclass(type):</div><div class="line">    def __new__(cls, name, bases, attrs):</div><div class="line">        # 添加一个属性</div><div class="line">        attrs[&apos;哈哈哈&apos;] = True</div><div class="line">        return type.__new__(cls, name, bases, attrs)</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="我们用一个实际例子来说明元类的用法"><a href="#我们用一个实际例子来说明元类的用法" class="headerlink" title="我们用一个实际例子来说明元类的用法"></a>我们用一个实际例子来说明元类的用法</h2><p><code>ORM</code>就是一个典型的使用元类的例子。<code>ORM</code>全称“Object Relational Mapping”，即对象-关系映射，就是把关系数据库的一行映射为一个对象，也就是一个类对应一个表，这样，写代码更简单，不用直接操作SQL语句。下面我就用这个<code>ORM</code>的例子来说明一下元类的用法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line">#ORM:object relational mapping 对象-关系映射</div><div class="line">#把关系数据库的一行映射为一个对象，也就是一个类对应一个表</div><div class="line">#ORM框架所有的类只能动态定义</div><div class="line"></div><div class="line"></div><div class="line"># 定义Field(定义域：元类遇到Field的方法或属性时即进行修改）</div><div class="line">class Field(object):</div><div class="line"></div><div class="line">    def __init__(self, name, column_type):  # column==&gt;列类型</div><div class="line">        self.name = name</div><div class="line">        self.column_type = column_type</div><div class="line"></div><div class="line">    # 当用print打印输出的时候，python会调用他的str方法</div><div class="line">    # 在这里是输出&lt;类的名字，实例的name参数(定义实例时输入)&gt;</div><div class="line">    # 在ModelMetaclass中会用到</div><div class="line">    def __str__(self):</div><div class="line">        return &quot;&lt;%s:%s&gt;&quot; % (self.__class__.__name__, self. name)  # __class__获取对象的类，__name__取得类名</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># 进一步定义各种类型的Field</div><div class="line">class StringField(Field):</div><div class="line"></div><div class="line">    def __init__(self, name):</div><div class="line">        # super(type[, object-or-type])  返回type的父类对象</div><div class="line">        # super().__init()的作用是调用父类的init函数</div><div class="line">        # varchar(100)和bigint都是sql中的一些数据类型</div><div class="line">        super(StringField, self).__init__(name, &quot;varchar(100)&quot;)  </div><div class="line"></div><div class="line">class IntegerField(Field):</div><div class="line"></div><div class="line">    def __init__(self, name):</div><div class="line">        super(IntegerField, self).__init__(name, &quot;bigint&quot;)</div><div class="line"></div><div class="line"></div><div class="line"># 编写ModelMetaclass</div><div class="line">class ModelMetaclass(type):</div><div class="line">    </div><div class="line">    # __new__方法接受的参数依次是：</div><div class="line">    # 1.当前准备创建的类的对象（cls）</div><div class="line">    # 2.类的名字（name）</div><div class="line">    # 3.类继承的父类集合(bases)</div><div class="line">    # 4.类的方法集合(attrs)</div><div class="line">    def __new__(cls, name, bases, attrs):</div><div class="line">        # 如果说新创建的类的名字是Model，那直接返回不做修改</div><div class="line">        if name == &quot;Model&quot;:</div><div class="line">            return type.__new__(cls, name, bases, attrs)</div><div class="line">        print(&quot;Found model:%s&quot; % name)</div><div class="line">        mappings = dict()</div><div class="line">        for k, v in attrs.items():</div><div class="line">            if isinstance(v, Field):</div><div class="line">                print(&quot;Found mappings:%s ==&gt; %s&quot; % (k, v))  # 找到映射， 这里用到上面的__str__</div><div class="line">                mappings[k] = v</div><div class="line">            # 结合之前，即把之前在方法集合中的零散的映射删除，</div><div class="line">            # 把它们从方法集合中挑出，组成一个大方法__mappings__</div><div class="line">            # 把__mappings__添加到方法集合attrs中</div><div class="line">        for k in mappings.keys():</div><div class="line">                attrs.pop(k)</div><div class="line">        attrs[&quot;__mappings__&quot;] = mappings</div><div class="line">        attrs[&quot;__table__&quot;] = name # 添加表名，假设表名与类名一致</div><div class="line">        return type.__new__(cls, name, bases, attrs)</div><div class="line"></div><div class="line"></div><div class="line"># 编写Model基类继承自dict中，这样可以使用一些dict的方法</div><div class="line">class Model(dict, metaclass=ModelMetaclass):</div><div class="line"></div><div class="line">    def __init__(self,  **kw):</div><div class="line">        # 调用父类，即dict的初始化方法</div><div class="line">        super(Model, self).__init__(**kw)</div><div class="line"></div><div class="line">    # 让获取key的值不仅仅可以d[k]，也可以d.k</div><div class="line">    def __getattr__(self, key):</div><div class="line">        try:</div><div class="line">            return self[key]</div><div class="line">        except KeyError:</div><div class="line">            raise AttributeError(r&quot;&apos;Model&apos; object has no attribute &apos;%s&apos;&quot; % key)</div><div class="line"></div><div class="line">    # 允许动态设置key的值，不仅仅可以d[k]，也可以d.k</div><div class="line">    def __setattr__(self, key, value):</div><div class="line">        self[key] = value</div><div class="line"></div><div class="line">    def save(self):</div><div class="line">        fields = []</div><div class="line">        params = []</div><div class="line">        args = []</div><div class="line">        # 在所有映射中迭代</div><div class="line">        for k, v in self.__mappings__.items():</div><div class="line">            fields.append(v.name)</div><div class="line">            params.append(&quot;?&quot;)</div><div class="line">            args.append(getattr(self, k, None))</div><div class="line">        sql = &quot;insert into %s (%s) values (%s)&quot; % (self.__table__, &quot;,&quot;.join(fields), &quot;,&quot;.join(params))</div><div class="line">        print(&quot;SQL: %s&quot; % sql)</div><div class="line">        print(&quot;ARGS: %s&quot; % str(args))</div><div class="line"></div><div class="line"></div><div class="line"># 这样一个简单的ORM就写完了</div><div class="line"></div><div class="line"></div><div class="line"># 下面实际操作一下，先定义个User类来对应数据库的表User</div><div class="line">class User(Model):</div><div class="line">    # 定义类的属性到列的映射</div><div class="line">    id = IntegerField(&quot;id&quot;)</div><div class="line">    name = StringField(&quot;username&quot;)</div><div class="line">    email = StringField(&quot;email&quot;)</div><div class="line">    password = StringField(&quot;password&quot;)</div><div class="line"></div><div class="line"></div><div class="line"># 创建一个实例</div><div class="line">u = User(id=12345, name=&quot;ReedSun&quot;, email=&quot;sunhongzhao@foxmail.com&quot;, password=&quot;nicaicai&quot;)</div><div class="line">u.save()</div></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/0014319106919344c4ef8b1e04c48778bb45796e0335839000" target="_blank" rel="external">使用元类-廖雪峰的官方网站</a></li>
<li><a href="http://blog.jobbole.com/21351/" target="_blank" rel="external">深刻理解python中的元类</a></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2016/10/21/使用python的email、smtplib、poplib模块收发邮件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/21/使用python的email、smtplib、poplib模块收发邮件/" itemprop="url">使用python的email、smtplib、poplib模块收发邮件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-21T10:53:32+08:00">
                2016-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>一封电子邮件的旅程是：<ul>
<li>MUA：Mail User Agent——邮件用户代理。(即类似Outlook的电子邮件软件）</li>
<li>MTA：Mail Transfer Agent——邮件传输代理，就是那些Email服务提供商，比如网易、新浪等等。</li>
<li>MDA：Mail Delivery Agent——邮件投递代理。Email服务提供商的某个服务器</li>
</ul>
</li>
</ul>
<blockquote>
<p>发件人 -&gt; MUA -&gt; MTA -&gt; MTA -&gt; 若干个MTA -&gt; MDA &lt;- MUA &lt;- 收件人</p>
</blockquote>
<ul>
<li><p>要编写程序来发送和接收邮件，本质上就是：</p>
<ul>
<li><p>编写MUA把邮件发到MTA；</p>
</li>
<li><p>编写MUA从MDA上收邮件。</p>
</li>
</ul>
</li>
<li><p>发邮件时，MUA和MTA使用的协议就是SMTP：Simple Mail Transfer Protocol，后面的MTA到另一个MTA也是用SMTP协议。</p>
</li>
<li>收邮件时，MUA和MDA使用的协议有两种：POP：Post Office Protocol，目前版本是3，俗称POP3；IMAP：Internet Message Access Protocol，目前版本是4，优点是不但能取邮件，还可以直接操作MDA上存储的邮件，比如从收件箱移到垃圾箱，等等。</li>
</ul>
<ul>
<li>构造一个邮件对象就是一个Messag对象，如果构造一个MIMEText对象，就表示一个文本邮件对象，如果构造一个MIMEImage对象，就表示一个作为附件的图片，要把多个对象组合起来，就用MIMEMultipart对象，而MIMEBase可以表示任何对象。它们的继承关系如下：</li>
</ul>
<blockquote>
<p>Message</p>
<blockquote>
<p>+- MIMEBase</p>
<blockquote>
<p>  +- MIMEMultipart<br>      +- MIMENonMultipart</p>
<blockquote>
<pre><code>+- MIMEMessage
 +- MIMEText
 +- MIMEImage
</code></pre></blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>##发送邮件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div></pre></td><td class="code"><pre><div class="line">from email.mime.text import MIMEText</div><div class="line"># email模块负责构造邮件</div><div class="line"># 类email.mime.text.MIMEText(_text)，是使用字符串_text来生成MIME对象的主体文本</div><div class="line"># MIME是(Multipurpose Internet Mail Extensions) 多用途互联网邮件扩展类型</div><div class="line"># MIME是设置将某种扩展名文件用一种应用程序来打开的方式类型</div><div class="line"># MIME设置的目的是为了在发送电子邮件时附加多媒体数据，让邮件根据其类型进行处理。</div><div class="line"></div><div class="line"></div><div class="line">import smtplib</div><div class="line"># smtplib模块负责发送邮件</div><div class="line"># 类smtplib.SMTP([host[, port[, local_hostname[, timeout]]]]) ：SMTP对象</div><div class="line">    # 其中，host：smtp服务器主机名</div><div class="line">    # 其中，port：smtp服务器的端口，默认是25</div><div class="line"># 如果在创建SMTP对象时定义了这两个参数，在初始化时会自动调用connect方式连接服务器</div><div class="line"># smtplib模块还提供了SMTP_SSL类和LMTP类，对它们的操作与SMTP基本一致。</div><div class="line"># SSL是一种安全传输，LMTP是与SMTP不同的另一种传输协议</div><div class="line"></div><div class="line"></div><div class="line">from email.header import Header</div><div class="line"># 如果你想让你的邮件标题使用非ASCII字符集，就要使用email.header编码非ASCII字符集</div><div class="line"># email.header.Header(s=None, charset=None, maxlinelen=None, header_name=None, continuation_ws=&apos; &apos;, errors=&apos;strict&apos;)</div><div class="line">    # 创建一个能容纳不同字符集的字符串的MIME对象的标头</div><div class="line">    # 其中，s：初始标头，即要编码之前的标头</div><div class="line">    # 其中，chatset：字符集，默认为ASCII</div><div class="line">    # 其中，maxlinelen：标头名的行的最大长度，默认为76</div><div class="line">    # 其中，header_name：标头名，默认无</div><div class="line">    # 其中，continuation_ws：默认为单个空格字符</div><div class="line">    # 其中，errors：直接传递到Header的append()方法里</div><div class="line"></div><div class="line"></div><div class="line">from email.utils import parseaddr, formataddr</div><div class="line"># email.utils:杂项工具</div><div class="line"># email.utils.parseaddr(address):解析地址的功能，</div><div class="line">    # 其中，address是一个包含用户名和email地址的值（realname&lt;address&gt;），返回一个二元组(realname, email address)</div><div class="line"># email.utils.formataddr(pair, charset=&apos;utf-8&apos;)</div><div class="line">    # 其中，pair是二元组(realname, email address)</div><div class="line">    # 其中，charset是字符串，默认为utf-8</div><div class="line"># 实际上，parseaddr(), formataddr(),两者互逆</div><div class="line"></div><div class="line"></div><div class="line">from email.mime.base import MIMEBase</div><div class="line"># email.mime.base.MIMEBase(_maintype, _subtype, **_params)</div><div class="line">    # 这是MIME的一个基类。一般不需要在使用时创建实例。</div><div class="line">    # 其中_maintype是内容类型，如text或者image。</div><div class="line">    # _subtype是内容的minor type 类型，如plain或者gif。</div><div class="line">    # **_params是一个字典，直接传递给Message.add_header()。</div><div class="line"></div><div class="line"></div><div class="line">from email.mime.multipart import MIMEMultipart</div><div class="line"># email.mime.multipart.MIMEMultipart(_subtype=&apos;mixed&apos;, boundary=None, _subparts=None, **_params)</div><div class="line">    # MIMEMultipart是MIMEBase的一个子类，多个MIME对象的集合</div><div class="line">    # _subtype默认值为mixed。boundary是MIMEMultipart的边界，默认边界是可数的。</div><div class="line"></div><div class="line"></div><div class="line">from email import encoders</div><div class="line"># email.encoders 功能是编码器</div><div class="line"></div><div class="line"></div><div class="line">def _format_addr(s):</div><div class="line"># 这个函数的作用是把一个标头的用户名编码成utf-8格式的，如果不编码原标头中文用户名，用户名将无法被邮件解码</div><div class="line">    name, addr = parseaddr(s)</div><div class="line">    return formataddr((Header(name, &quot;utf-8&quot;).encode(), addr))</div><div class="line">    # Header().encode(splitchars=&apos;;, \t&apos;, maxlinelen=None, linesep=&apos;\n&apos;)</div><div class="line">        # 功能：编码一个邮件标头，使之变成一个RFC兼容的格式</div><div class="line"></div><div class="line"></div><div class="line"># 先定义Email的地址，口令和SMTP服务器地址</div><div class="line">from_addr = &quot;947503956@qq.com&quot;</div><div class="line">password = input(&quot;请输入发送邮箱的密码:&quot;)</div><div class="line">to_addr = &quot;sunwstmz@163.com&quot;</div><div class="line">smtp_server = &quot;smtp.qq.com&quot;</div><div class="line"></div><div class="line"></div><div class="line"># 接下来定义邮件本身的内容</div><div class="line">msg = MIMEMultipart()</div><div class="line">msg[&quot;From&quot;] = _format_addr(&quot;发送者ReedSun &lt;%s&gt;&quot; % from_addr)</div><div class="line">msg[&quot;To&quot;] = _format_addr(&quot;接收者ReedSun &lt;%s&gt;&quot; % to_addr)</div><div class="line">msg[&quot;Subject&quot;] = Header(&quot;哈哈哈 这是一封测试信&quot;, &quot;utf-8&quot;).encode()</div><div class="line"># 定义邮件正文</div><div class="line">msg.attach(MIMEText(&quot;这是一封来自大魔王ReedSun，用Python发来的邮件&quot;, &quot;plain&quot;, &quot;utf-8&quot;))</div><div class="line"># class email.mime.text.MIMEText(_text[, _subtype[, _charset]])：MIME文本对象，</div><div class="line">    # 其中, _text是邮件内容，</div><div class="line">    # 其中, _subtype邮件类型(MIME类型)，可以是text/plain（普通文本邮件），html/plain(html邮件),</div><div class="line">    # 其中, _charset编码（charset：字符集），可以是gb2312等等。</div><div class="line"># message.attch(payload) 将给定的附件或信息，添加到已有的有效附件或信息中，在调用之前必须是None或者List，调用后。payload将变成信息对象的列表</div><div class="line"># 如果你想将payload设置成一个标量对象，要使用set_payload()</div><div class="line">with open(&apos;c:/work/test.jpg&apos;, &apos;rb&apos;) as f:</div><div class="line">    mime = MIMEBase(&quot;image&quot;, &quot;jpg&quot;, filename=&quot;test.jpg&quot;)</div><div class="line">    mime.add_header(&quot;Content-Disposition&quot;, &quot;attchment&quot;, filename=&quot;test.jpg&quot;)</div><div class="line">    # add_header(_name, _value, **_params) 扩展标头设置</div><div class="line">        # _name：要添加的标头字段</div><div class="line">        # _value：标头的内容</div><div class="line">    # Content-Disposition就是当用户想把请求所得的内容存为一个文件的时候提供一个默认的文件名。</div><div class="line">        # 希望某类或者某已知MIME 类型的文件（比如：*.gif;*.txt;*.htm）能够在访问时弹出“文件下载”对话框。</div><div class="line">    mime.add_header(&quot;Content-ID&quot;, &quot;&lt;0&gt;&quot;)</div><div class="line">    mime.add_header(&quot;X-Attachment-Id&quot;, &quot;0&quot;)</div><div class="line">    mime.set_payload(f.read())</div><div class="line">    # set_payload(payload, charset=None)</div><div class="line">        # 将附件添加到payload中</div><div class="line">    encoders.encode_base64(mime)</div><div class="line">    # encoders.encode_base64(mime) 将payload内容编码为base64格式</div><div class="line">    msg.attach(mime)</div><div class="line"></div><div class="line"></div><div class="line"># 接下来定义发送文件</div><div class="line">server = smtplib.SMTP_SSL(smtp_server, 465)</div><div class="line"># qq邮箱使用SSL连接，端口为465</div><div class="line">server.set_debuglevel(1)</div><div class="line"># SMTP.set_debuglevel(level)：设置是否为调试模式。默认为False，即非调试模式，</div><div class="line"># 非调试模式：表示不输出任何调试信息。</div><div class="line">server.login(from_addr, password)</div><div class="line"># 登陆到smtp服务器。</div><div class="line"># 现在几乎所有的smtp服务器，都必须在验证用户信息合法之后才允许发送邮件。</div><div class="line">server.sendmail(from_addr, [to_addr], msg.as_string())</div><div class="line"># SMTP.sendmail(from_addr, to_addrs, msg[, mail_options, rcpt_options]) ：发送邮件。</div><div class="line"># 这里要注意一下第三个参数，msg是字符串，表示邮件。</div><div class="line"># 我们知道邮件一般由标题，发信人，收件人，邮件内容，附件等构成，</div><div class="line"># 发送邮件的时候，要注意msg的格式。这个格式就是smtp协议中定义的格式。</div><div class="line"># 第二个参数，接受邮箱为一个列表，表示可以设置多个接受邮箱</div><div class="line"># as_string()是MIMEMessage对象的一个方法，表示把MIMETest对象变成str</div><div class="line">server.quit()</div><div class="line"># 断开与smtp服务器的连接，相当于发送&quot;quit&quot;指令。</div></pre></td></tr></table></figure></p>
<p>##接受邮件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line">from email.parser import Parser</div><div class="line"># email.parser 解析电子邮件</div><div class="line">    # 返回这个对象的email.message.Message实例</div><div class="line">from email.header import decode_header</div><div class="line">from email.utils import parseaddr</div><div class="line">import poplib</div><div class="line"></div><div class="line"></div><div class="line">email = &quot;947503956@qq.com&quot;</div><div class="line">password = input(&quot;密码:&quot;)</div><div class="line">pop3_server = &quot;pop.qq.com&quot;</div><div class="line"></div><div class="line"># 连接到POP3服务器</div><div class="line">server = poplib.POP3_SSL(pop3_server)</div><div class="line"># 注意qq邮箱使用SSL连接</div><div class="line"># 打开调试信息</div><div class="line">server.set_debuglevel(1)</div><div class="line"># 打印POP3服务器的欢迎文字</div><div class="line">print(server.getwelcome().decode(&quot;utf-8&quot;))</div><div class="line"></div><div class="line"># 身份认证</div><div class="line">server.user(email)</div><div class="line">server.pass_(password)</div><div class="line"></div><div class="line"># stat()返回邮件数量和占用空间</div><div class="line">print(&quot;信息数量：%s 占用空间 %s&quot; % server.stat())</div><div class="line"># list()返回(response, [&apos;mesg_num octets&apos;, ...], octets)，第二项是编号</div><div class="line">resp, mails, octets = server.list()</div><div class="line">print(&quot;list!!!!&quot;,server.list())</div><div class="line"># 返回的列表类似[b&apos;1 82923&apos;, b&apos;2 2184&apos;, ...]</div><div class="line">print(mails)</div><div class="line"></div><div class="line"># 获取最新一封邮件，注意索引号从1开始</div><div class="line"># POP3.retr(which) 检索序号which的真个消息，然后设置他的出现标志 返回(response, [&apos;line&apos;, ...], octets)这个三元组</div><div class="line">index = len(mails)</div><div class="line">resp, lines, ocetes = server.retr(index)</div><div class="line"></div><div class="line"># lines 存储了邮件的原始文本的每一行</div><div class="line"># 可以获得整个邮件的原始文本</div><div class="line">msg_content = b&quot;\r\n&quot;.join(lines).decode(&quot;utf-8&quot;)</div><div class="line"># 稍后解析出邮件</div><div class="line">msg = Parser().parsestr(msg_content)</div><div class="line"># email.Parser.parsestr(text, headersonly=False)</div><div class="line">    # 与parser()方法类似，不同的是他接受一个字符串对象而不是一个类似文件的对象</div><div class="line">    # 可选的headersonly表示是否在解析玩标题后停止解析，默认为否</div><div class="line">    # 返回根消息对象</div><div class="line"></div><div class="line"># 关闭连接</div><div class="line">server.quit()</div><div class="line"></div><div class="line"></div><div class="line">#### 解析邮件</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># 邮件的Subject或者Email中包含的名字都是经过编码后的str，要正常显示，就必须decode</div><div class="line">def decode_str(s):</div><div class="line">    value, charset = decode_header(s)[0]</div><div class="line">    # decode_header()返回一个list，因为像Cc、Bcc这样的字段可能包含多个邮件地址，所以解析出来的会有多个元素。上面的代码我们偷了个懒，只取了第一个元素。</div><div class="line">    if charset:</div><div class="line">        value = value.decode(charset)</div><div class="line">    return value</div><div class="line"></div><div class="line"></div><div class="line"># 文本邮件的内容也是str，还需要检测编码，否则，非UTF-8编码的邮件都无法正常显示</div><div class="line">def guess_charset(msg):</div><div class="line">    charset = msg.get_charset()</div><div class="line">    if charset is None:</div><div class="line">        content_type = msg.get(&apos;Content-Type&apos;, &apos;&apos;).lower()</div><div class="line">        pos = content_type.find(&apos;charset=&apos;)</div><div class="line">        if pos &gt;= 0:</div><div class="line">            charset = content_type[pos + 8:].strip()</div><div class="line">    return charset</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"># 解析邮件与构造邮件的步骤正好相反</div><div class="line">def print_info(msg, indent=0):</div><div class="line">    if indent ==0:</div><div class="line">        for header in [&quot;From&quot;, &quot;To&quot;, &quot;Subject&quot;]:</div><div class="line">            value = msg.get(header, &quot;&quot;)</div><div class="line">            if value:</div><div class="line">                if header == &quot;Subject&quot;:</div><div class="line">                    vaule = decode_str(value)</div><div class="line">                else:</div><div class="line">                    hdr, addr =parseaddr(value)</div><div class="line">                    name = decode_str(hdr)</div><div class="line">                    value = u&quot;%s &lt;%s&gt;&quot; % (name, addr)</div><div class="line">            print(&quot;%s%s:%s&quot; % (&quot;  &quot; * indent, header, value))</div><div class="line">        if (msg .is_multipart()):</div><div class="line">            parts = msg.get_payload()</div><div class="line">            for n, part in enumerate(parts):</div><div class="line">                print(&apos;%spart %s&apos; % (&apos;  &apos; * indent, n))</div><div class="line">                print(&apos;%s--------------------&apos; % (&apos;  &apos; * indent))</div><div class="line">                print_info(part, indent + 1)</div><div class="line">        else:</div><div class="line">            content_type = msg.get_content_type()</div><div class="line">            if content_type==&apos;text/plain&apos; or content_type==&apos;text/html&apos;:</div><div class="line">                content = msg.get_payload(decode=True)</div><div class="line">                charset = guess_charset(msg)</div><div class="line">                if charset:</div><div class="line">                    content = content.decode(charset)</div><div class="line">                print(&apos;%sText: %s&apos; % (&apos;  &apos; * indent, content + &apos;...&apos;))</div><div class="line">            else:</div><div class="line">                print(&apos;%sAttachment: %s&apos; % (&apos;  &apos; * indent, content_type))</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2016/10/15/Python的自带模块——HTMLParser的初步学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/15/Python的自带模块——HTMLParser的初步学习/" itemprop="url">Python的自带模块——HTMLParser的初步学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-15T14:49:19+08:00">
                2016-10-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>HTMLParser是Python自带的模块，使用简单，能够很容易的实现HTML文件的分析。</li>
<li><p>本文主要简单讲一下HTMLParser的用法. </p>
</li>
<li><p>使用时需要定义一个<strong>从模块<code>html.parser</code>中的类<code>HTMLParser</code>继承的</strong>类，重定义函数：</p>
<ul>
<li><code>handle_starttag( tag, attrs)</code></li>
<li><code>handle_startendtag( tag, attrs)</code></li>
<li><code>handle_endtag( tag)</code></li>
<li><code>handle_data(data)</code></li>
</ul>
</li>
</ul>
<p>##1. 获取标签属性</p>
<ul>
<li><code>tag</code>是的html标签，<code>attrs</code>是 (属性，值)元组(<code>tuple</code>)的列表(<code>list</code>). </li>
</ul>
<p>如一个标签为：</p>
<blockquote>
<p><code>&lt;input type=&quot;hidden&quot; name=&quot;NXX&quot; id=&quot;IDXX&quot; value=&quot;VXX&quot; /&gt;</code></p>
</blockquote>
<p>那么它的<code>attrs</code>列表为</p>
<blockquote>
<p>`[(‘type’, ‘hidden’), (‘name’, ‘NXX’), (‘id’, ‘IDXX’), (‘value’, ‘VXX’)]</p>
</blockquote>
<ul>
<li><code>HTMLParser</code>自动将<code>tag</code>和<code>attrs</code>都转为小写。</li>
</ul>
<p>##2. 获取标签内容</p>
<ul>
<li>解析时碰到<code>&lt;***&gt;</code>，自动调用<code>handle_starttag()</code>；碰到<code>&lt;/***&gt;</code>，自动调用<code>handle_endtag()</code></li>
<li><p>每一个标签，无论<code>&lt;&gt;</code> 还是<code>&lt;/&gt;</code>，均会调用<code>handle_data()</code></p>
</li>
<li><p>html中第一行、第二行分别为<code>&lt;html&gt;</code>和<code>&lt;head&gt;</code>，后面无具体数据，只有回车换行，所用调用<code>handle_data()</code>，打印结果为换行；<code>&lt;/html&gt;&lt;/head&gt;</code>同理。</p>
</li>
</ul>
<p>##3. 一个简单的例子</p>
<ul>
<li>获取豆瓣上正在上映影片的基本信息<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"># encoding=utf8</div><div class="line">import requests</div><div class="line">from html.parser import HTMLParser</div><div class="line">from html.entities import name2codepoint</div><div class="line"></div><div class="line"></div><div class="line">class Myparser(HTMLParser):</div><div class="line">    def __init__(self):</div><div class="line">        HTMLParser.__init__(self)</div><div class="line">        self.movies = []</div><div class="line"></div><div class="line">    def handle_starttag(self, tag, attrs):</div><div class="line">        def _attr(attrlist, attrname):</div><div class="line">            for each in attrlist:</div><div class="line">                if attrname == each[0]:</div><div class="line">                    return each[1]</div><div class="line">            return None</div><div class="line"></div><div class="line">        if tag == &apos;li&apos; and _attr(attrs, &apos;data-title&apos;):</div><div class="line">            movie = &#123;&#125;</div><div class="line">            movie[&apos;actors&apos;] = _attr(attrs, &apos;data-actors&apos;)</div><div class="line">            movie[&apos;director&apos;] = _attr(attrs, &apos;data-director&apos;)</div><div class="line">            movie[&apos;duration&apos;] = _attr(attrs, &apos;data-dutation&apos;)</div><div class="line">            movie[&apos;title&apos;] = _attr(attrs, &apos;data-title&apos;)</div><div class="line">            movie[&apos;rate&apos;] = _attr(attrs, &apos;data-rate&apos;)</div><div class="line">            self.movies.append(movie)</div><div class="line"></div><div class="line"></div><div class="line">def movieparser(url):</div><div class="line">    headers = &#123;&#125;</div><div class="line">    req = requests.get(url)</div><div class="line">    s = req.text</div><div class="line">    myparser = Myparser()</div><div class="line">    myparser.feed(s)</div><div class="line">    myparser.close()</div><div class="line">    return myparser.movies</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    url = &apos;https://movie.douban.com/&apos;</div><div class="line">    movies = movieparser(url)</div><div class="line">    for each in movies:</div><div class="line">        print(&apos;%(title)s|%(rate)s|%(actors)s|%(director)s|%(duration)s&apos; % each)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>运行结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">湄公河行动|8.2|张涵予 / 彭于晏 / 孙淳|林超贤|None</div><div class="line">圆梦巨人 The BFG|6.7|鲁比·巴恩希尔 / 马克·里朗斯 / 比尔·哈德尔|史蒂文·斯皮尔伯格|None</div><div class="line">从你的全世界路过|5.5|邓超 / 白百何 / 杨洋|张一白|None</div><div class="line">暗杀游戏 Мафия: Игра на выживание|4.3|瓦蒂姆·提萨拉提 / 维奥莱塔·吉特孟斯塔雅 / 韦尼亚明·斯梅霍夫|萨里·奥德赛耶|None</div><div class="line">鲁滨逊漂流记 Robinson Crusoe|5.5|马提亚斯·施维赫夫 / 卡亚·叶娜尔 / 伊尔卡·贝桑|文森特·凯斯特鲁特|None</div><div class="line">勇士|4.7|李东学 / 于小伟 / 聂远|宁海强|None</div><div class="line">黑处有什么|6.8|苏晓彤 / 郭笑 / 陆琦蔚|王一淳|None</div><div class="line">王牌逗王牌|3.6|刘德华 / 黄晓明 / 王祖蓝|王晶|None</div><div class="line">爵迹|3.7|范冰冰 / 吴亦凡 / 陈学冬|郭敬明|None</div><div class="line">铠甲勇士捕王|4.1|赖艺 / 王畅唱 / 曲澔濬|郑国伟|None</div><div class="line">逗鸟外传：萌宝满天飞 Storks|7.7|安迪·萨姆伯格 / 凯蒂·克朗 / 凯尔希·格兰莫|尼古拉斯·斯托勒|None</div><div class="line">宾虚 Ben-Hur|5.8|杰克·休斯顿 / 纳赞宁·波妮阿蒂 / 摩根·弗里曼|提莫·贝克曼贝托夫|None</div><div class="line">幽灵医院|2.4|白歆惠 / 李昌熙 / 罗家英|殷国君|None</div><div class="line">T台魔王||朱研 / 班嘉佳 / 侯静文|牛辉|None</div><div class="line">我是哪吒|4.9|陶典 / 韩娇娇 / 刘垚|舒展|None</div><div class="line">神兽金刚之青龙再现|5.5|黄健 / 李仲鑫 / 谢安晟|朱晓兵|None</div><div class="line">疯狂丑小鸭|2.8|苏倩芸 / 王雪沁 / 杨进|蒋叶峰|None</div><div class="line">樱桃小丸子：来自意大利的少年 ちびまる子ちゃん イタリアから来た少年|7.1|鳕子 / 屋良有作 / 一龙斋贞友|高木淳|None</div><div class="line">新东方神娃||王燕华 / 王晓彤 / 李晔|殷晓东|None</div><div class="line">七月与安生|7.6|周冬雨 / 马思纯 / 李程彬|曾国祥|None</div><div class="line">爱上处女座|4.1|萧蔷 / 贺刚 / 高天|刘观伟|None</div><div class="line"></div><div class="line">Process finished with exit code 0</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2016/10/14/初见Python的第三方模块BeautifulSoup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/14/初见Python的第三方模块BeautifulSoup/" itemprop="url">初见Python的第三方模块BeautifulSoup</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-14T20:13:59+08:00">
                2016-10-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh/" target="_blank" rel="external">中文版官方文档</a></p>
</li>
<li><p>安装BeautifulSoup。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pip install beautifulsoup4</div></pre></td></tr></table></figure>
</li>
<li><p><code>Beautiful Soup</code> 是一个可以从<code>HTML</code>或<code>XML</code>文件中提取数据的Python库.它能够通过你喜欢的转换器实现惯用的文档导航,查找,修改文档的方式.<code>Beautiful Soup</code>会帮你节省数小时甚至数天的工作时间.</p>
</li>
<li><p>解析器</p>
<ul>
<li><p><code>Beautiful Soup</code>支持Python标准库中的HTML解析器,还支持一些第三方的解析器,其中一个是 <code>lxml</code> .根据操作系统不同,可以选择下列方法来安装<code>lxml</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ apt-get install Python-lxml</div><div class="line"></div><div class="line">$ easy_install lxml</div><div class="line"></div><div class="line">$ pip install lxml</div></pre></td></tr></table></figure>
</li>
<li><p>另一个可供选择的解析器是纯Python实现的 <code>html5lib</code> , html5lib的解析方式与浏览器相同,可以选择下列方法来安装<code>html5lib</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ apt-get install Python-html5lib</div><div class="line"></div><div class="line">$ easy_install html5lib</div><div class="line"></div><div class="line">$ pip install html5lib</div></pre></td></tr></table></figure>
</li>
<li><p>推荐使用lxml作为解析器,因为效率更高.</p>
</li>
<li>下表列出了主要的解析器,以及它们的优缺点:<br>|解析器    |使用方法|    优势    |劣势|<br>| — | — | — | — |<br>|Python标准库|    BeautifulSoup(markup, “html.parser”)    |Python的内置标准库,执行速度适中,文档容错能力强|Python 2.7.3 or 3.2.2)前 的版本中文档容错能力差|<br>|lxml HTML 解析器|    BeautifulSoup(markup, “lxml”)       |速度快,文档容错能力强|需要安装C语言库|<br>|lxml XML 解析器|    BeautifulSoup(markup, [“lxml”, “xml”])，BeautifulSoup(markup, “xml”)|速度快唯一支持XML的解析器|需要安装C语言库|<br>|html5lib|    BeautifulSoup(markup, “html5lib”)|    最好的容错性，以浏览器的方式解析文档，生成HTML5格式的文档|速度慢，不依赖外部扩展|</li>
</ul>
</li>
</ul>
<p>##如何使用</p>
<ul>
<li><p>将一段文档传入<code>BeautifulSoup</code> 的构造方法,就能得到一个文档的对象, 可以传入一段字符串或一个文件句柄.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">from bs4 import BeautifulSoup</div><div class="line"></div><div class="line">soup = BeautifulSoup(open(&quot;index.html&quot;))</div><div class="line"></div><div class="line">soup = BeautifulSoup(&quot;&lt;html&gt;data&lt;/html&gt;&quot;)</div></pre></td></tr></table></figure>
</li>
<li><p>首先,文档被转换成Unicode,并且HTML的实例都被转换成Unicode编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">BeautifulSoup(&quot;Sacr&amp;eacute; bleu!&quot;)</div><div class="line">&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;Sacré bleu!&lt;/body&gt;&lt;/html&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>然后,Beautiful Soup选择最合适的解析器来解析这段文档,如果手动指定解析器那么Beautiful Soup会选择指定的解析器来解析文档.</p>
<ul>
<li>建议，传入<code>BeautifulSoup</code>时就定义好解析器，就像如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">BeautifulSoup([your markup], &quot;html.parser&quot;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>##对象的种类</p>
<ul>
<li><code>Beautiful Soup</code>将复杂HTML文档转换成一个复杂的树形结构,每个节点都是Python对象,所有对象可以归纳为4种: <code>Tag</code>, <code>NavigableString</code> , <code>BeautifulSoup</code> , <code>Comment</code> .</li>
</ul>
<p>##搜索文档树</p>
<ul>
<li>Beautiful Soup定义了很多搜索方法,在这里我先只学习这一个<code>find()</code></li>
</ul>
<p>###find()</p>
<ul>
<li><p><code>find( name , attrs , recursive , text , **kwargs )</code></p>
</li>
<li><p><code>find_all()</code> 方法将返回文档中符合条件的所有tag的列表,尽管有时候我们只想得到一个结果.比如文档中只有一个<code>&lt;body&gt;</code>标签,那么使用 <code>find_all()</code> 方法来查找<code>&lt;body&gt;</code>标签就不太合适, 使用 <code>find_all</code> 方法并设置 <code>limit=1</code> 参数也可以做到，但是远不如直接使用 find() 方法来的方便.下面两行代码是等价的:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">soup.find_all(&apos;title&apos;, limit=1)</div><div class="line"># [&lt;title&gt;The Dormouse&apos;s story&lt;/title&gt;]</div><div class="line"></div><div class="line">soup.find(&apos;title&apos;)</div><div class="line"># &lt;title&gt;The Dormouse&apos;s story&lt;/title&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>唯一的区别是 find_all() 方法的返回结果是值包含一个元素的列表,而 find() 方法直接返回结果.</p>
</li>
<li><p>find_all() 方法没有找到目标是返回空列表, find() 方法找不到目标时,返回 None .</p>
</li>
</ul>
<p>##CSS选择器</p>
<ul>
<li><p><code>Beautiful Soup</code>支持大部分的CSS选择器 ,在 <code>Tag</code> 或 <code>BeautifulSoup</code> 对象的 <code>.select()</code> 方法中传入字符串参数,即可使用CSS选择器的语法找到tag:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">soup.select(&quot;title&quot;)</div><div class="line"># [&lt;title&gt;The Dormouse&apos;s story&lt;/title&gt;]</div></pre></td></tr></table></figure>
</li>
<li><p>可以通过传入多个tag标签逐层查找:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">soup.select(&quot;body a&quot;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot;  id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&quot;html head title&quot;)</div><div class="line"># [&lt;title&gt;The Dormouse&apos;s story&lt;/title&gt;]</div></pre></td></tr></table></figure>
</li>
<li><p>也可以通过使用大于号&lt;的方式找到某个tag标签下的直接子标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">soup.select(&quot;head &gt; title&quot;)</div><div class="line"># [&lt;title&gt;The Dormouse&apos;s story&lt;/title&gt;]</div><div class="line"></div><div class="line">soup.select(&quot;p &gt; a&quot;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot;  id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&quot;p &gt; a:nth-of-type(2)&quot;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&quot;p &gt; #link1&quot;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&quot;body &gt; a&quot;)</div><div class="line"># []</div></pre></td></tr></table></figure>
</li>
<li><p>通过CSS的类名查找</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">soup.select(&quot;.sister&quot;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&quot;[class~=sister]&quot;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</div></pre></td></tr></table></figure>
</li>
<li><p>通过tag的id查找</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">soup.select(&quot;#link1&quot;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&quot;a#link2&quot;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;]</div></pre></td></tr></table></figure>
</li>
<li><p>通过是否存在某个属性来查找:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">soup.select(&apos;a[href]&apos;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</div></pre></td></tr></table></figure>
</li>
<li><p>通过属性的值来查找:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">soup.select(&apos;a[href=&quot;http://example.com/elsie&quot;]&apos;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&apos;a[href^=&quot;http://example.com/&quot;]&apos;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;,</div><div class="line">#  &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&apos;a[href$=&quot;tillie&quot;]&apos;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;]</div><div class="line"></div><div class="line">soup.select(&apos;a[href*=&quot;.com/el&quot;]&apos;)</div><div class="line"># [&lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;]</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>BeautifulSoup实际上就是对HTMLParser的人性化封装，它的功能很强大，我现在只学习了一点皮毛，以后还要多翻看官方文档才是，加油~</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2016/09/28/获取对象信息/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/28/获取对象信息/" itemprop="url">获取对象信息</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-28T12:02:04+08:00">
                2016-09-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>学习日期：2016年9月27日</em><br><em>学习课程：<a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431866385235335917b66049448ab14a499afd5b24db000" target="_blank" rel="external">获取对象信息 - 廖雪峰的官方网站</a></em><br>在本节中，我学习了可以通过<code>type()</code>或者<code>isinstance()</code>可以获得和判断对象的类型信息，他们两者的不同,在于<code>type()</code><strong>不会认为</strong>子类是一种父类类型,<code>isinstance()</code><strong>会认为</strong>子类是一种父类类型。<br>还学习了使用<code>dir()</code>可以获得一个对象的所有属性和方法。使用<code>getattr()</code>、<code>setattr()</code>、<code>hasattr()</code>、<code>delsattr()</code>，我们可以操作一个对象的属性和方法</p>
<h2 id="使用type"><a href="#使用type" class="headerlink" title="使用type()"></a>使用<code>type()</code></h2><ul>
<li><code>type(object）</code>函数接收一个object（对象），并且返回这个object对应的class类型。<ul>
<li>object可以是基本数据类型，比如<code>int</code>、<code>str</code>、……</li>
<li>object也可以是一个函数或者一个类（class）,比如<code>abs</code>、<code>Animal</code>……</li>
</ul>
</li>
<li>因为type对象返回对应的class类型，如果要判断一个对象的类型是不是某一个特定的类型的话就比较麻烦。<ul>
<li>对于基本数据类型还好说，可以直接写<code>int</code>、<code>str</code>等来判断，例如<code>type(123)==int</code>。</li>
<li>但是对于其他数据类型（函数、lambda、generator、……）来说，就不能用上面的方法了。但是也有对应的解决之策，那就是使用<code>type</code>模块中定义的常量。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import types</div><div class="line">&gt;&gt;&gt; def fn():</div><div class="line">...     pass</div><div class="line">...</div><div class="line">&gt;&gt;&gt; type(fn)==types.FunctionType</div><div class="line">True</div><div class="line">&gt;&gt;&gt; type(abs)==types.BuiltinFunctionType</div><div class="line">True</div><div class="line">&gt;&gt;&gt; type(lambda x: x)==types.LambdaType</div><div class="line">True</div><div class="line">&gt;&gt;&gt; type((x for x in range(10)))==types.GeneratorType</div><div class="line">True</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>##使用<code>isinstance()</code></p>
<ul>
<li><p>对于判断一个对象是不是某一个类或者类型，我们有一个类似的函数<code>isinstance()</code>。<code>type()</code>与<code>isinstance()</code>之间不存在孰优孰劣，只有哪个更适合某个特定的需求而已。</p>
</li>
<li><p>他与<code>type()</code>有一个明显的区别，即<code>type()</code>不会认为子类是一种父类类型,而<code>isinstance()</code>会认为子类是一种父类类型。</p>
</li>
<li><p><code>isinstance()</code>的语法是：<code>isinstance(object,class)</code>。</p>
<ul>
<li><code>object</code>是要判断类型的数据对象，<code>class</code>是要判断的类型或者类。</li>
<li><code>class</code>也可以是一个元组（里面包含若干个<code>class</code>或<code>type</code>），这样表达的意思是判断一个对象是否是某些类型中的一种。</li>
</ul>
</li>
<li><p>如果<code>class</code>是<code>object</code>的父类，也会输出<code>True</code>，但是如果<code>class</code>是<code>object</code>的子类，就会输出<code>False</code>。<strong>换句话说，isinstance()判断的是一个对象是否是该类型本身，或者位于该类型的父继承链上。</strong><br>##使用<code>dir()</code></p>
</li>
<li>通过<code>dir()</code>函数我们可以获得一个对象的所有属性和方法，它将返回一个包含对象的全部的属性和方法的字符串的list。</li>
<li>其返回的list中从形式上包含两种大类，一个是<code>__xxx__</code>，另一个是<code>xxx</code>。<ul>
<li>类似<code>__xxx__</code>的属性和方法在Python中都是有特殊用途的，比如<code>__len__</code>方法返回长度。</li>
<li><code>xxx</code>则是普通属性或方法，比如<code>lower()</code>返回小写的字符串。</li>
</ul>
</li>
<li>通过<code>getattr()</code>、<code>setattr()</code>、<code>hasattr()</code>、<code>delasttr()</code>，我们可以直接操作一个对象的的属性和方法。<ul>
<li><code>getattr()</code>的作用是访问对象的属性或方法，其语法是<code>getattr(obj, name[, default])</code>，将返回属性或方法的值，如果方法或值不存在，就返回<code>default</code>的值。</li>
<li><code>setattr()</code>的作用是设置一个属性或方法。如果属性不存在，会创建一个新属性，其语法是<code>setattr(obj,name,value)</code>，没有返回值。如果要设置方法，可以使用lambda匿名函数。</li>
<li><code>hasattr()</code>的作用是检查是否存在一个属性或方法，其语法为<code>hasattr(obj,name)</code>。如果存在这个属性或方法返回<code>True</code>，否则返回<code>False</code>。</li>
<li><code>delasttr()</code>的作用是删除一个属性，其语法为<code>delattr(obj, name)</code>。</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://reedsun.top/2016/09/27/learningnote_Object oriented Programming/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ReedSun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Preeminent">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/27/learningnote_Object oriented Programming/" itemprop="url">Python中面向对象编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-27T12:18:48+08:00">
                2016-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><em>Object oriented Programming – 面对对象编程（OOP）</em></p>
<p>Python从设计之初就已经是一门面向对象的语言，正因为如此，在Python中创建一个类和对象是很容易的。</p>
<p>##面向对象技术简介</p>
<ul>
<li><strong>类(Class)</strong>: 用来描述具有相同的属性和方法的对象的集合。它定义了该集合中每个对象所共有的属性和方法。对象是类的实例。</li>
<li><strong>类变量</strong>：类变量在整个实例化的对象中是公用的。类变量定义在类中且在函数体之外。类变量通常不作为实例变量使用。</li>
<li><strong>数据成员</strong>：类变量或者实例变量用于处理类及其实例对象的相关的数据。</li>
<li><strong>方法重写</strong>：如果从父类继承的方法不能满足子类的需求，可以对其进行改写，这个过程叫方法的覆盖（override），也称为方法的重写。</li>
<li><strong>实例变量</strong>：定义在方法中的变量，只作用于当前实例的类。</li>
<li><strong>继承</strong>：即一个<em>派生类（derived class）</em>继承<em>基类（base class）</em>的字段和方法。继承也允许把一个派生类的对象作为一个基类对象对待。例如，有这样一个设计：一个Dog类型的对象派生自Animal类，这是模拟”是一个（is-a）”关系（例图，Dog是一个Animal）。</li>
<li><strong>实例化</strong>：创建一个类的实例，类的具体对象。</li>
<li><strong>方法</strong>：类中定义的函数。</li>
<li><strong>对象</strong>：通过类定义的数据结构实例。对象包括两个数据成员（类变量和实例变量）和方法。<h2 id="创建类"><a href="#创建类" class="headerlink" title="创建类"></a>创建类</h2>使用class语句来创建一个新类，class之后为类的名称并以冒号结尾，如下实例:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class ClassName:</div><div class="line">   &apos;类的帮助信息&apos;   #类文档字符串</div><div class="line">   class_suite  #类体</div></pre></td></tr></table></figure>
</li>
</ul>
<p>类的帮助信息可以通过<code>ClassName.__doc__</code>查看。<br><code>class_suite</code> 由类成员，方法，数据属性组成。</p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>以下是一个简单的Python类实例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"># -*- coding: UTF-8 -*-</div><div class="line"></div><div class="line">class Employee:</div><div class="line">   &apos;所有员工的基类&apos;</div><div class="line">   empCount = 0</div><div class="line"></div><div class="line">   def __init__(self, name, salary):</div><div class="line">      self.name = name</div><div class="line">      self.salary = salary</div><div class="line">      Employee.empCount += 1</div><div class="line">   </div><div class="line">   def displayCount(self):</div><div class="line">     print &quot;Total Employee %d&quot; % Employee.empCount</div><div class="line"></div><div class="line">   def displayEmployee(self):</div><div class="line">      print &quot;Name : &quot;, self.name,  &quot;, Salary: &quot;, self.salary</div></pre></td></tr></table></figure></p>
<ul>
<li><code>empCount</code>变量是一个类变量，它的值将在这个类的所有实例之间共享。你可以在内部类或外部类使用<code>Employee.empCount</code>访问。</li>
<li>第一种方法<code>__init__()</code>方法是一种特殊的方法，被称为类的构造函数或初始化方法，当创建了这个类的实例时就会调用该方法<h2 id="创建实例对象"><a href="#创建实例对象" class="headerlink" title="创建实例对象"></a>创建实例对象</h2>要创建一个类的实例，你可以使用类的名称，并通过<code>__init__</code>方法接受参数。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&quot;创建 Employee 类的第一个对象&quot;</div><div class="line">emp1 = Employee(&quot;Zara&quot;, 2000)</div><div class="line">&quot;创建 Employee 类的第二个对象&quot;</div><div class="line">emp2 = Employee(&quot;Manni&quot;, 5000)</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="访问属性"><a href="#访问属性" class="headerlink" title="访问属性"></a>访问属性</h2><p>您可以使用点(.)来访问对象的属性。使用如下类的名称访问类变量:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">emp1.displayEmployee()</div><div class="line">emp2.displayEmployee()</div><div class="line">print &quot;Total Employee %d&quot; % Employee.empCount</div></pre></td></tr></table></figure></p>
<p>完整实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"># -*- coding: UTF-8 -*-</div><div class="line"></div><div class="line">class Employee:</div><div class="line">   &apos;所有员工的基类&apos;</div><div class="line">   empCount = 0</div><div class="line"></div><div class="line">   def __init__(self, name, salary):</div><div class="line">      self.name = name</div><div class="line">      self.salary = salary</div><div class="line">      Employee.empCount += 1</div><div class="line">   </div><div class="line">   def displayCount(self):</div><div class="line">     print &quot;Total Employee %d&quot; % Employee.empCount</div><div class="line"></div><div class="line">   def displayEmployee(self):</div><div class="line">      print &quot;Name : &quot;, self.name,  &quot;, Salary: &quot;, self.salary</div><div class="line"></div><div class="line">&quot;创建 Employee 类的第一个对象&quot;</div><div class="line">emp1 = Employee(&quot;Zara&quot;, 2000)</div><div class="line">&quot;创建 Employee 类的第二个对象&quot;</div><div class="line">emp2 = Employee(&quot;Manni&quot;, 5000)</div><div class="line">emp1.displayEmployee()</div><div class="line">emp2.displayEmployee()</div><div class="line">print &quot;Total Employee %d&quot; % Employee.empCount</div></pre></td></tr></table></figure></p>
<p>执行以上代码输出结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Name :  Zara ,Salary:  2000</div><div class="line">Name :  Manni ,Salary:  5000</div><div class="line">Total Employee 2</div></pre></td></tr></table></figure></p>
<p>你可以添加，删除，修改类的属性，如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">emp1.age = 7  # 添加一个 &apos;age&apos; 属性</div><div class="line">emp1.age = 8  # 修改 &apos;age&apos; 属性</div><div class="line">del emp1.age  # 删除 &apos;age&apos; 属性</div></pre></td></tr></table></figure></p>
<p>你也可以使用以下函数的方式来访问属性：</p>
<ul>
<li><code>getattr(obj, name[, default])</code> : 访问对象的属性。</li>
<li><code>hasattr(obj,name)</code> : 检查是否存在一个属性。</li>
<li><code>setattr(obj,name,value)</code>:设置一个属性。如果属性不存在，会创建一个新属性。</li>
<li><code>delattr(obj, name)</code> : 删除属性。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">hasattr(emp1, &apos;age&apos;)    # 如果存在 &apos;age&apos; 属性返回 True。</div><div class="line">getattr(emp1, &apos;age&apos;)    # 返回 &apos;age&apos; 属性的值</div><div class="line">setattr(emp1, &apos;age&apos;, 8) # 添加属性 &apos;age&apos; 值为 8</div><div class="line">delattr(empl, &apos;age&apos;)    # 删除属性 &apos;age&apos;</div></pre></td></tr></table></figure>
<h2 id="Python内置类属性"><a href="#Python内置类属性" class="headerlink" title="Python内置类属性"></a>Python内置类属性</h2><ul>
<li><code>__dict__</code> : 类的属性（包含一个字典，由类的数据属性组成）</li>
<li><code>__doc__</code> :类的文档字符串</li>
<li><code>__name__</code>: 类名</li>
<li><code>__module__</code>: 类定义所在的模块（类的全名是’<code>__main__.className</code>‘，如果类位于一个导入模块mymod中，那么<code>className.__module__</code> 等于 mymod）</li>
<li><code>__bases__</code> : 类的所有父类构成元素（包含了一个由所有父类组成的元组）<br>Python内置类属性调用实例如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"># -*- coding: UTF-8 -*-</div><div class="line"></div><div class="line">class Employee:</div><div class="line">   &apos;所有员工的基类&apos;</div><div class="line">   empCount = 0</div><div class="line"></div><div class="line">   def __init__(self, name, salary):</div><div class="line">      self.name = name</div><div class="line">      self.salary = salary</div><div class="line">      Employee.empCount += 1</div><div class="line">   </div><div class="line">   def displayCount(self):</div><div class="line">     print &quot;Total Employee %d&quot; % Employee.empCount</div><div class="line"></div><div class="line">   def displayEmployee(self):</div><div class="line">      print &quot;Name : &quot;, self.name,  &quot;, Salary: &quot;, self.salary</div><div class="line"></div><div class="line">print &quot;Employee.__doc__:&quot;, Employee.__doc__</div><div class="line">print &quot;Employee.__name__:&quot;, Employee.__name__</div><div class="line">print &quot;Employee.__module__:&quot;, Employee.__module__</div><div class="line">print &quot;Employee.__bases__:&quot;, Employee.__bases__</div><div class="line">print &quot;Employee.__dict__:&quot;, Employee.__dict__</div></pre></td></tr></table></figure>
</li>
</ul>
<p>执行以上代码输出结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Employee.__doc__: 所有员工的基类</div><div class="line">Employee.__name__: Employee</div><div class="line">Employee.__module__: __main__</div><div class="line">Employee.__bases__: ()</div><div class="line">Employee.__dict__: &#123;&apos;__module__&apos;: &apos;__main__&apos;, &apos;displayCount&apos;: &lt;function displayCount at 0x10a939c80&gt;, &apos;empCount&apos;: 0, &apos;displayEmployee&apos;: &lt;function displayEmployee at 0x10a93caa0&gt;, &apos;__doc__&apos;: &apos;\xe6\x89\x80\xe6\x9c\x89\xe5\x91\x98\xe5\xb7\xa5\xe7\x9a\x84\xe5\x9f\xba\xe7\xb1\xbb&apos;, &apos;__init__&apos;: &lt;function __init__ at 0x10a939578&gt;&#125;</div></pre></td></tr></table></figure></p>
<h2 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h2><p>面向对象的编程带来的主要好处之一是代码的重用，实现这种重用的方法之一是通过继承机制。继承完全可以理解成类之间的类型和子类型关系。<br>需要注意的地方：<strong>继承语法</strong> class 派生类名（<strong>基类名</strong>）：//… 基类名写作括号里，基本类是在类定义的时候，在元组之中指明的。<br>在python中继承中的一些特点：</p>
<ul>
<li>1：在继承中基类的构造（<code>__init__</code>()方法）不会被自动调用，它需要在其派生类的构造中亲自专门调用。</li>
<li>2：在调用基类的方法时，需要加上基类的类名前缀，且需要带上self参数变量。区别于在类中调用普通函数时并不需要带上self参数</li>
<li>3：Python总是首先查找对应类型的方法，如果它不能在派生类中找到对应的方法，它才开始到基类中逐个查找。（先在本类中查找调用的方法，找不到才去基类中找）。</li>
</ul>
<p>如果在继承元组中列了一个以上的类，那么它就被称作”多重继承” 。<br>语法：<br>派生类的声明，与他们的父类类似，继承的基类列表跟在类名之后，如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class SubClassName (ParentClass1[, ParentClass2, ...]):</div><div class="line">   &apos;Optional class documentation string&apos;</div><div class="line">   class_suite</div></pre></td></tr></table></figure></p>
<p>实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"># -*- coding: UTF-8 -*-</div><div class="line"></div><div class="line">class Parent:        # 定义父类</div><div class="line">   parentAttr = 100</div><div class="line">   def __init__(self):</div><div class="line">      print &quot;调用父类构造函数&quot;</div><div class="line"></div><div class="line">   def parentMethod(self):</div><div class="line">      print &apos;调用父类方法&apos;</div><div class="line"></div><div class="line">   def setAttr(self, attr):</div><div class="line">      Parent.parentAttr = attr</div><div class="line"></div><div class="line">   def getAttr(self):</div><div class="line">      print &quot;父类属性 :&quot;, Parent.parentAttr</div><div class="line"></div><div class="line">class Child(Parent): # 定义子类</div><div class="line">   def __init__(self):</div><div class="line">      print &quot;调用子类构造方法&quot;</div><div class="line"></div><div class="line">   def childMethod(self):</div><div class="line">      print &apos;调用子类方法 child method&apos;</div><div class="line"></div><div class="line">c = Child()          # 实例化子类</div><div class="line">c.childMethod()      # 调用子类的方法</div><div class="line">c.parentMethod()     # 调用父类方法</div><div class="line">c.setAttr(200)       # 再次调用父类的方法</div><div class="line">c.getAttr()          # 再次调用父类的方法</div></pre></td></tr></table></figure></p>
<p>以上代码执行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">调用子类构造方法</div><div class="line">调用子类方法 child method</div><div class="line">调用父类方法</div><div class="line">父类属性 : 200</div></pre></td></tr></table></figure></p>
<p>你可以继承多个类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class A:        # 定义类 A</div><div class="line">.....</div><div class="line"></div><div class="line">class B:         # 定义类 B</div><div class="line">.....</div><div class="line"></div><div class="line">class C(A, B):   # 继承类 A 和 B</div><div class="line">.....</div></pre></td></tr></table></figure></p>
<p>你可以使用issubclass()或者isinstance()方法来检测。</p>
<ul>
<li>issubclass() - <strong>布尔函数</strong>判断一个类是另一个类的子类或者子孙类，语法：issubclass(sub,sup)</li>
<li>isinstance(obj, Class) 布尔函数如果obj是Class类的实例对象或者是一个Class子类的实例对象则返回true。<h2 id="方法重写"><a href="#方法重写" class="headerlink" title="方法重写"></a>方法重写</h2>如果你的父类方法的功能不能满足你的需求，你可以在子类重写你父类的方法：<br>实例：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"># -*- coding: UTF-8 -*-</div><div class="line"></div><div class="line">class Parent:        # 定义父类</div><div class="line">   def myMethod(self):</div><div class="line">      print &apos;调用父类方法&apos;</div><div class="line"></div><div class="line">class Child(Parent): # 定义子类</div><div class="line">   def myMethod(self):</div><div class="line">      print &apos;调用子类方法&apos;</div><div class="line"></div><div class="line">c = Child()          # 子类实例</div><div class="line">c.myMethod()         # 子类调用重写方法</div></pre></td></tr></table></figure>
</li>
</ul>
<p>执行以上代码输出结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">调用子类方法</div></pre></td></tr></table></figure></p>
<h2 id="基础重载方法"><a href="#基础重载方法" class="headerlink" title="基础重载方法"></a>基础重载方法</h2><p>下表列出了一些通用的功能，你可以在自己的类重写：<br>|序号|方法|描述|简单的调用|<br>| :–: | :–: | :–: | :–: |<br>|1|<code>__init__ ( self [,args...] )</code>|构造函数|<code>obj = className(args)</code>|<br>|2|<code>__del__( self )</code>|析构方法, 删除一个对象|<code>dell obj</code>|<br>|3|<code>__repr__( self )</code>|转化为供解释器读取的形式|<code>repr(obj)</code>|<br>|4|<code>__str__( self )</code>|用于将值转化为适于人阅读的形式|<code>str(obj)</code>|<br>|5|<code>__cmp__ ( self, x )</code>|对象比较|<code>cmp(obj, x)</code>|</p>
<p>##运算符重载<br>Python同样支持运算符重载，实例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"></div><div class="line">class Vector:</div><div class="line">   def __init__(self, a, b):</div><div class="line">      self.a = a</div><div class="line">      self.b = b</div><div class="line"></div><div class="line">   def __str__(self):</div><div class="line">      return &apos;Vector (%d, %d)&apos; % (self.a, self.b)</div><div class="line">   </div><div class="line">   def __add__(self,other):</div><div class="line">      return Vector(self.a + other.a, self.b + other.b)</div><div class="line"></div><div class="line">v1 = Vector(2,10)</div><div class="line">v2 = Vector(5,-2)</div><div class="line">print v1 + v2</div></pre></td></tr></table></figure></p>
<p>以上代码执行结果如下所示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Vector(7,8)</div></pre></td></tr></table></figure></p>
<p>##类属性与方法</p>
<h3 id="类的私有属性"><a href="#类的私有属性" class="headerlink" title="类的私有属性"></a>类的私有属性</h3><p><code>__private_attrs</code>：两个下划线开头，声明该属性为私有，不能在类地外部被使用或直接访问。在类内部的方法中使用时 <code>self.__private_attrs</code>。</p>
<h3 id="类的方法"><a href="#类的方法" class="headerlink" title="类的方法"></a>类的方法</h3><p>在类地内部，使用def关键字可以为类定义一个方法，与一般函数定义不同，类方法必须包含参数self,且为第一个参数</p>
<h3 id="类的私有方法"><a href="#类的私有方法" class="headerlink" title="类的私有方法"></a>类的私有方法</h3><p><code>__private_method</code>：两个下划线开头，声明该方法为私有方法，不能在类地外部调用。在类的内部调用 <code>self.__private_methods</code></p>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/python</div><div class="line"># -*- coding: UTF-8 -*-</div><div class="line"></div><div class="line">class JustCounter:</div><div class="line">	__secretCount = 0  # 私有变量</div><div class="line">	publicCount = 0    # 公开变量</div><div class="line"></div><div class="line">	def count(self):</div><div class="line">		self.__secretCount += 1</div><div class="line">		self.publicCount += 1</div><div class="line">		print self.__secretCount</div><div class="line"></div><div class="line">counter = JustCounter()</div><div class="line">counter.count()</div><div class="line">counter.count()</div><div class="line">print counter.publicCount</div><div class="line">print counter.__secretCount  # 报错，实例不能访问私有变量</div></pre></td></tr></table></figure>
<p>Python 通过改变名称来包含类名:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">2</div><div class="line">2</div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;test.py&quot;, line 17, in &lt;module&gt;</div><div class="line">    print counter.__secretCount  # 报错，实例不能访问私有变量</div><div class="line">AttributeError: JustCounter instance has no attribute &apos;__secretCount&apos;</div></pre></td></tr></table></figure></p>
<p>Python不允许实例化的类访问私有数据，但你可以使用 <code>object._className__attrName</code> 访问属性，将如下代码替换以上代码的最后一行代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">.........................</div><div class="line">print counter._JustCounter__secretCount</div></pre></td></tr></table></figure></p>
<p>执行以上代码，执行结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line">2</div><div class="line">2</div><div class="line">2</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="ReedSun" />
          <p class="site-author-name" itemprop="name">ReedSun</p>
           
              <p class="site-description motion-element" itemprop="description">ReedSun</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ReedSun</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

</body>
</html>
